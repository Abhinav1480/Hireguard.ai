import { useState, useEffect, useRef, useCallback } from "react";
import {
  AreaChart, Area, LineChart, Line, BarChart, Bar, PieChart, Pie, Cell,
  RadarChart, Radar, PolarGrid, PolarAngleAxis,
  XAxis, YAxis, Tooltip, ResponsiveContainer, CartesianGrid, Legend
} from "recharts";
import {
  LayoutDashboard, Brain, FileText, Target, TrendingUp, FileBarChart,
  Settings, Shield, Bell, LogOut, User, ChevronRight, AlertTriangle,
  CheckCircle, Upload, Download, Trash2, Search, Filter, Plus,
  RefreshCw, Eye, EyeOff, Mail, Lock, Building2, Users, Activity,
  X, ChevronDown, Info, Zap, Award, BarChart2, Database, Cpu,
  FolderOpen, FileSearch, Clock, XCircle, Edit, Save
} from "lucide-react";

// ‚îÄ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const API_BASE = "http://localhost:5000/api";

const DEMO_TRANSCRIPT = `Interviewer: So tell me about yourself. How old are you exactly?
Candidate: I'm Sarah, 34, with 8 years in product management.
Interviewer: Are you planning to have children soon? That might affect availability.
Candidate: I prefer to keep that private.
Interviewer: Where are you originally from? Your name sounds foreign.
Candidate: I'm from Chicago, born and raised.
Interviewer: Our team is mostly young guys who work late. What religion are you? We have Friday events.
Candidate: I'd rather not say.
Interviewer: We need someone without family distractions. Can you commit fully?`;

const DEMO_RESUME = `PROFESSIONAL SUMMARY
Results-driven professional leveraging synergies to orchestrate cross-functional initiatives and spearhead transformative solutions. Adept at utilizing cutting-edge methodologies to drive impactful outcomes.

EXPERIENCE
Senior Product Manager | TechCorp | 2020‚ÄìPresent
‚Ä¢ Spearheaded development of innovative product roadmaps aligned with strategic objectives
‚Ä¢ Orchestrated cross-departmental collaboration to streamline processes and enhance efficiency
‚Ä¢ Leveraged data-driven insights to optimize user engagement and drive meaningful growth

SKILLS
Strategic Planning | Cross-functional Leadership | Data Analysis | Agile/Scrum | Stakeholder Management`;

// ‚îÄ‚îÄ‚îÄ MOCK DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MOCK_TREND = [
  { week: "W1", bias: 68, fraud: 42, risk: 72 },
  { week: "W2", bias: 72, fraud: 55, risk: 75 },
  { week: "W3", bias: 58, fraud: 38, risk: 61 },
  { week: "W4", bias: 45, fraud: 29, risk: 49 },
  { week: "W5", bias: 52, fraud: 33, risk: 55 },
  { week: "W6", bias: 38, fraud: 21, risk: 42 },
  { week: "W7", bias: 31, fraud: 18, risk: 34 },
  { week: "W8", bias: 28, fraud: 15, risk: 30 },
];

const MOCK_DEPT = [
  { dept: "Engineering", score: 42, count: 28 },
  { dept: "Sales", score: 68, count: 15 },
  { dept: "HR", score: 22, count: 12 },
  { dept: "Design", score: 35, count: 9 },
  { dept: "Operations", score: 51, count: 20 },
  { dept: "Legal", score: 18, count: 7 },
];

const MOCK_INTERVIEWS = [
  { _id: "1", recruiterName: "Alex Chen", department: "Engineering", candidateName: "Jordan Smith", biasScore: 18, riskLevel: "Low", status: "Reviewed", createdAt: new Date(Date.now() - 86400000 * 1).toISOString() },
  { _id: "2", recruiterName: "Maria Santos", department: "Sales", candidateName: "Priya Patel", biasScore: 62, riskLevel: "High", status: "Pending", createdAt: new Date(Date.now() - 86400000 * 2).toISOString() },
  { _id: "3", recruiterName: "James Patel", department: "Operations", candidateName: "Chris Lee", biasScore: 45, riskLevel: "Moderate", status: "Pending", createdAt: new Date(Date.now() - 86400000 * 3).toISOString() },
  { _id: "4", recruiterName: "Sarah Kim", department: "HR", candidateName: "Mohammed Ali", biasScore: 78, riskLevel: "Critical", status: "Pending", createdAt: new Date(Date.now() - 86400000 * 4).toISOString() },
  { _id: "5", recruiterName: "David Wu", department: "Design", candidateName: "Emma Wilson", biasScore: 12, riskLevel: "Low", status: "Reviewed", createdAt: new Date(Date.now() - 86400000 * 5).toISOString() },
];

const MOCK_RESUMES = [
  { _id: "1", candidateName: "Jordan Smith", position: "Sr. Engineer", aiProbabilityScore: 82, classification: "Almost Certainly AI", status: "Flagged", createdAt: new Date(Date.now() - 86400000).toISOString() },
  { _id: "2", candidateName: "Emma Wilson", position: "UX Designer", aiProbabilityScore: 23, classification: "Likely Human", status: "Cleared", createdAt: new Date(Date.now() - 86400000 * 2).toISOString() },
  { _id: "3", candidateName: "Marcus Brown", position: "PM", aiProbabilityScore: 55, classification: "Mixed", status: "Pending", createdAt: new Date(Date.now() - 86400000 * 3).toISOString() },
];

const MOCK_USERS = [
  { _id: "1", name: "Admin User", email: "admin@hireguard.ai", role: "Admin", department: "Platform", isActive: true, lastLogin: new Date().toISOString() },
  { _id: "2", name: "HR Manager", email: "hr@hireguard.ai", role: "HR", department: "Human Resources", isActive: true, lastLogin: new Date(Date.now() - 86400000).toISOString() },
  { _id: "3", name: "Auditor", email: "audit@hireguard.ai", role: "Auditor", department: "Compliance", isActive: true, lastLogin: new Date(Date.now() - 86400000 * 2).toISOString() },
];

// ‚îÄ‚îÄ‚îÄ THEME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const COLORS = {
  risk: { low: "#10b981", moderate: "#f59e0b", high: "#ef4444", critical: "#dc2626" },
  chart: ["#6366f1", "#8b5cf6", "#06b6d4", "#10b981", "#f59e0b", "#ef4444"]
};

const riskColor = (score) => score < 25 ? COLORS.risk.low : score < 50 ? COLORS.risk.moderate : score < 75 ? COLORS.risk.high : COLORS.risk.critical;
const riskLabel = (score) => score < 25 ? "Low Risk" : score < 50 ? "Moderate" : score < 75 ? "High Risk" : "Critical";
const riskFromLabel = (label) => ({ Low: COLORS.risk.low, Moderate: COLORS.risk.moderate, High: COLORS.risk.high, Critical: COLORS.risk.critical }[label] || "#94a3b8");

// ‚îÄ‚îÄ‚îÄ GLOBAL STYLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const GLOBAL_CSS = `
  @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap');

  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body, #root { height: 100%; overflow: hidden; }
  body { font-family: 'Outfit', sans-serif; background: #0B1426; color: #e2e8f0; }

  ::-webkit-scrollbar { width: 5px; height: 5px; }
  ::-webkit-scrollbar-track { background: rgba(15,23,42,0.5); }
  ::-webkit-scrollbar-thumb { background: rgba(99,102,241,0.4); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: rgba(99,102,241,0.7); }

  @keyframes fadeUp { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:translateY(0); } }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
  @keyframes scaleIn { from { opacity:0; transform:scale(0.95); } to { opacity:1; transform:scale(1); } }
  @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.5; } }
  @keyframes spin { to { transform: rotate(360deg); } }
  @keyframes float { 0%,100% { transform:translateY(0); } 50% { transform:translateY(-6px); } }
  @keyframes gradShift { 0% { background-position:0% 50%; } 50% { background-position:100% 50%; } 100% { background-position:0% 50%; } }
  @keyframes numberUp { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
  @keyframes slideRight { from { width:0; } to { width: var(--w); } }

  .fade-up { animation: fadeUp 0.4s ease forwards; }
  .fade-in { animation: fadeIn 0.3s ease forwards; }
  .scale-in { animation: scaleIn 0.3s ease forwards; }
  .spin { animation: spin 1s linear infinite; }
  .pulse { animation: pulse 2s ease infinite; }
  .float { animation: float 3s ease-in-out infinite; }

  .glass {
    background: rgba(15, 23, 42, 0.7);
    backdrop-filter: blur(16px);
    border: 1px solid rgba(99,102,241,0.12);
  }
  .glass-bright {
    background: rgba(30, 41, 59, 0.8);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(99,102,241,0.2);
  }
  .card {
    background: linear-gradient(135deg, rgba(30,41,59,0.9), rgba(15,23,42,0.95));
    border: 1px solid rgba(99,102,241,0.15);
    border-radius: 12px;
    transition: border-color 0.2s, transform 0.2s, box-shadow 0.2s;
  }
  .card:hover { border-color: rgba(99,102,241,0.35); }
  .card-elevated:hover { transform: translateY(-1px); box-shadow: 0 8px 32px rgba(0,0,0,0.4); }

  .btn-primary {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    color: white;
    border: none;
    cursor: pointer;
    font-family: 'Outfit', sans-serif;
    font-weight: 600;
    transition: all 0.2s;
    display: inline-flex; align-items: center; gap: 6px;
  }
  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(99,102,241,0.4); filter: brightness(1.1); }
  .btn-primary:active { transform: translateY(0); }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .btn-secondary {
    background: rgba(30,41,59,0.8);
    color: #94a3b8;
    border: 1px solid rgba(99,102,241,0.2);
    cursor: pointer;
    font-family: 'Outfit', sans-serif;
    font-weight: 500;
    transition: all 0.2s;
    display: inline-flex; align-items: center; gap: 6px;
  }
  .btn-secondary:hover { background: rgba(51,65,85,0.8); color: #e2e8f0; border-color: rgba(99,102,241,0.4); }

  .btn-danger {
    background: rgba(239,68,68,0.1);
    color: #fca5a5;
    border: 1px solid rgba(239,68,68,0.3);
    cursor: pointer;
    font-family: 'Outfit', sans-serif;
    font-weight: 500;
    transition: all 0.2s;
    display: inline-flex; align-items: center; gap: 6px;
  }
  .btn-danger:hover { background: rgba(239,68,68,0.2); border-color: rgba(239,68,68,0.5); }

  .btn-success {
    background: rgba(16,185,129,0.1);
    color: #6ee7b7;
    border: 1px solid rgba(16,185,129,0.3);
    cursor: pointer;
    font-family: 'Outfit', sans-serif;
    font-weight: 500;
    transition: all 0.2s;
    display: inline-flex; align-items: center; gap: 6px;
  }
  .btn-success:hover { background: rgba(16,185,129,0.2); }

  .input {
    background: rgba(15,23,42,0.8);
    border: 1px solid rgba(99,102,241,0.2);
    color: #e2e8f0;
    font-family: 'Outfit', sans-serif;
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
  }
  .input:focus { border-color: rgba(99,102,241,0.6); box-shadow: 0 0 0 3px rgba(99,102,241,0.1); }
  .input::placeholder { color: rgba(148,163,184,0.4); }

  .sidebar-item {
    display: flex; align-items: center; gap: 10px;
    padding: 9px 12px; border-radius: 8px;
    cursor: pointer; transition: all 0.15s;
    color: #64748b; font-size: 13.5px; font-weight: 500;
    border: 1px solid transparent;
    white-space: nowrap;
  }
  .sidebar-item:hover { background: rgba(99,102,241,0.08); color: #a5b4fc; }
  .sidebar-item.active {
    background: linear-gradient(135deg, rgba(99,102,241,0.2), rgba(139,92,246,0.15));
    color: #a5b4fc;
    border-color: rgba(99,102,241,0.3);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
  }

  .table { width: 100%; border-collapse: collapse; }
  .table th { padding: 10px 14px; text-align: left; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: #64748b; border-bottom: 1px solid rgba(99,102,241,0.15); background: rgba(15,23,42,0.5); }
  .table td { padding: 11px 14px; font-size: 13px; border-bottom: 1px solid rgba(99,102,241,0.07); color: #cbd5e1; }
  .table tr:hover td { background: rgba(99,102,241,0.04); }
  .table tr:last-child td { border-bottom: none; }

  .badge {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 3px 8px; border-radius: 5px;
    font-size: 11px; font-weight: 600;
    font-family: 'JetBrains Mono', monospace;
    text-transform: uppercase; letter-spacing: 0.04em;
  }
  .badge-low { background: rgba(16,185,129,0.12); color: #10b981; border: 1px solid rgba(16,185,129,0.25); }
  .badge-moderate { background: rgba(245,158,11,0.12); color: #f59e0b; border: 1px solid rgba(245,158,11,0.25); }
  .badge-high { background: rgba(239,68,68,0.12); color: #ef4444; border: 1px solid rgba(239,68,68,0.3); }
  .badge-critical { background: rgba(220,38,38,0.2); color: #fca5a5; border: 1px solid rgba(220,38,38,0.4); }
  .badge-pending { background: rgba(148,163,184,0.1); color: #94a3b8; border: 1px solid rgba(148,163,184,0.2); }
  .badge-reviewed { background: rgba(16,185,129,0.1); color: #10b981; border: 1px solid rgba(16,185,129,0.25); }
  .badge-flagged { background: rgba(239,68,68,0.1); color: #ef4444; border: 1px solid rgba(239,68,68,0.25); }
  .badge-cleared { background: rgba(16,185,129,0.1); color: #10b981; border: 1px solid rgba(16,185,129,0.25); }

  .tab-btn { padding: 7px 16px; border-radius: 7px; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.15s; border: 1px solid transparent; font-family: 'Outfit', sans-serif; }
  .tab-btn.active { background: rgba(99,102,241,0.2); color: #a5b4fc; border-color: rgba(99,102,241,0.35); }
  .tab-btn:not(.active) { color: #64748b; background: transparent; }
  .tab-btn:not(.active):hover { color: #94a3b8; background: rgba(99,102,241,0.06); }

  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); z-index: 100; display: flex; align-items: center; justify-content: center; }
  .modal { background: #0f172a; border: 1px solid rgba(99,102,241,0.25); border-radius: 16px; max-height: 90vh; overflow-y: auto; animation: scaleIn 0.2s ease; }

  .section-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: #475569; margin-bottom: 12px; font-family: 'JetBrains Mono', monospace; }

  .metric-value { font-family: 'JetBrains Mono', monospace; font-weight: 600; animation: numberUp 0.5s ease; }

  .risk-bar { height: 6px; border-radius: 3px; background: rgba(30,41,59,0.8); overflow: hidden; }
  .risk-bar-fill { height: 100%; border-radius: 3px; transition: width 1s cubic-bezier(0.4,0,0.2,1); }

  .gradient-text { background: linear-gradient(135deg, #6366f1, #8b5cf6, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

  .notification-dot { width: 8px; height: 8px; background: #ef4444; border-radius: 50%; position: absolute; top: -2px; right: -2px; animation: pulse 2s infinite; }

  .drag-zone { border: 2px dashed rgba(99,102,241,0.3); border-radius: 12px; padding: 40px; text-align: center; transition: all 0.2s; cursor: pointer; }
  .drag-zone:hover, .drag-zone.dragging { border-color: rgba(99,102,241,0.6); background: rgba(99,102,241,0.06); }

  .score-ring { transform: rotate(-90deg); }
  .score-track { fill: none; stroke: rgba(30,41,59,0.8); stroke-width: 8; }
  .score-fill { fill: none; stroke-width: 8; stroke-linecap: round; transition: stroke-dashoffset 1.5s cubic-bezier(0.4,0,0.2,1); }

  .tooltip-custom { background: rgba(15,23,42,0.97) !important; border: 1px solid rgba(99,102,241,0.3) !important; border-radius: 10px !important; font-family: 'JetBrains Mono', monospace !important; font-size: 11px !important; }

  textarea.input { resize: vertical; min-height: 120px; }
  select.input { appearance: none; }
`;

// ‚îÄ‚îÄ‚îÄ UTILITY COMPONENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const Spinner = ({ size = 16 }) => (
  <div className="spin" style={{ width: size, height: size, border: `2px solid rgba(99,102,241,0.3)`, borderTopColor: "#6366f1", borderRadius: "50%" }} />
);

const ScoreRing = ({ score, size = 100, strokeW = 8 }) => {
  const r = (size - strokeW * 2) / 2;
  const circ = 2 * Math.PI * r;
  const offset = circ - (score / 100) * circ;
  const color = riskColor(score);
  return (
    <div style={{ position: "relative", width: size, height: size }}>
      <svg width={size} height={size} className="score-ring">
        <circle cx={size/2} cy={size/2} r={r} className="score-track" strokeWidth={strokeW} />
        <circle cx={size/2} cy={size/2} r={r} className="score-fill" stroke={color}
          strokeWidth={strokeW} strokeDasharray={circ} strokeDashoffset={offset}
          style={{ filter: `drop-shadow(0 0 6px ${color}80)` }} />
      </svg>
      <div style={{ position: "absolute", inset: 0, display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center" }}>
        <span style={{ fontSize: size * 0.22, fontWeight: 700, color, fontFamily: "JetBrains Mono" }}>{score}</span>
        <span style={{ fontSize: size * 0.1, color: "#64748b", fontFamily: "JetBrains Mono" }}>/100</span>
      </div>
    </div>
  );
};

const MetricCard = ({ icon: Icon, label, value, sub, color = "#6366f1", trend, delay = 0 }) => (
  <div className="card card-elevated fade-up" style={{ padding: 20, animationDelay: `${delay}s` }}>
    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 14 }}>
      <div style={{ width: 38, height: 38, borderRadius: 10, background: `${color}20`, border: `1px solid ${color}35`, display: "flex", alignItems: "center", justifyContent: "center" }}>
        <Icon size={17} style={{ color }} />
      </div>
      {trend !== undefined && (
        <span style={{ fontSize: 12, fontWeight: 600, color: trend > 0 ? "#ef4444" : "#10b981", fontFamily: "JetBrains Mono" }}>
          {trend > 0 ? "‚Üë" : "‚Üì"}{Math.abs(trend)}%
        </span>
      )}
    </div>
    <div className="metric-value" style={{ fontSize: 28, color: "white", marginBottom: 4 }}>{value}</div>
    <div style={{ fontSize: 13, color: "#64748b" }}>{label}</div>
    {sub && <div style={{ fontSize: 11, color, marginTop: 4, fontWeight: 500 }}>{sub}</div>}
  </div>
);

const Badge = ({ level, label }) => {
  const cls = `badge badge-${level?.toLowerCase().replace(" ", "-") || "pending"}`;
  return <span className={cls}>{label || level}</span>;
};

const TooltipContent = ({ active, payload, label }) => {
  if (!active || !payload?.length) return null;
  return (
    <div className="tooltip-custom" style={{ padding: "8px 12px" }}>
      <p style={{ color: "#94a3b8", marginBottom: 6 }}>{label}</p>
      {payload.map((p, i) => (
        <p key={i} style={{ color: p.color, fontSize: 12 }}>{p.name}: <span style={{ color: "white", fontWeight: 600 }}>{p.value}</span></p>
      ))}
    </div>
  );
};

const SectionHeader = ({ title, children }) => (
  <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 20 }}>
    <h2 style={{ fontSize: 18, fontWeight: 700, color: "white" }}>{title}</h2>
    <div style={{ display: "flex", gap: 8 }}>{children}</div>
  </div>
);

// ‚îÄ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const AuthScreen = ({ onLogin }) => {
  const [mode, setMode] = useState("login");
  const [form, setForm] = useState({ name: "Admin User", email: "admin@hireguard.ai", password: "password123", role: "Admin" });
  const [showPw, setShowPw] = useState(false);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");

  const submit = async () => {
    setLoading(true); setError("");
    try {
      // Try real API first, fallback to demo login
      try {
        const endpoint = mode === "login" ? "/auth/login" : "/auth/register";
        const body = mode === "login" ? { email: form.email, password: form.password } : form;
        const res = await fetch(`${API_BASE}${endpoint}`, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(body) });
        const data = await res.json();
        if (data.success) { onLogin(data.token, data.user); return; }
        throw new Error(data.message);
      } catch (apiErr) {
        // Demo mode fallback
        if (form.email && form.password) {
          const demoUser = { _id: "demo", name: form.name || "Demo User", email: form.email, role: form.role || "Admin", department: "Platform" };
          onLogin("demo-token", demoUser);
          return;
        }
        throw new Error("Please enter email and password");
      }
    } catch (err) { setError(err.message); }
    setLoading(false);
  };

  return (
    <div style={{ minHeight: "100vh", display: "flex", alignItems: "center", justifyContent: "center", background: "linear-gradient(135deg, #0B1426 0%, #0f172a 50%, #0B1426 100%)", padding: 20 }}>
      <style>{GLOBAL_CSS}</style>

      {/* Background glow orbs */}
      <div style={{ position: "fixed", inset: 0, pointerEvents: "none", overflow: "hidden" }}>
        <div style={{ position: "absolute", width: 600, height: 600, borderRadius: "50%", background: "radial-gradient(circle, rgba(99,102,241,0.08) 0%, transparent 70%)", top: "10%", left: "20%", animation: "float 8s ease-in-out infinite" }} />
        <div style={{ position: "absolute", width: 400, height: 400, borderRadius: "50%", background: "radial-gradient(circle, rgba(139,92,246,0.06) 0%, transparent 70%)", bottom: "15%", right: "25%", animation: "float 10s ease-in-out infinite 2s" }} />
      </div>

      <div className="fade-up" style={{ width: 420, position: "relative" }}>
        {/* Logo */}
        <div style={{ textAlign: "center", marginBottom: 32 }}>
          <div style={{ width: 64, height: 64, borderRadius: 18, background: "linear-gradient(135deg, rgba(99,102,241,0.3), rgba(139,92,246,0.3))", border: "1px solid rgba(99,102,241,0.5)", display: "flex", alignItems: "center", justifyContent: "center", margin: "0 auto 16px", boxShadow: "0 0 40px rgba(99,102,241,0.25)" }}>
            <Shield size={30} style={{ color: "#a5b4fc" }} />
          </div>
          <h1 style={{ fontSize: 28, fontWeight: 800, color: "white", marginBottom: 4 }}>
            <span className="gradient-text">HireGuard AI</span>
          </h1>
          <p style={{ color: "#475569", fontSize: 13 }}>Enterprise Hiring Governance Platform</p>
        </div>

        <div className="glass-bright" style={{ borderRadius: 16, padding: 32 }}>
          {/* Mode tabs */}
          <div style={{ display: "flex", gap: 4, marginBottom: 24, padding: 4, background: "rgba(15,23,42,0.8)", borderRadius: 10, border: "1px solid rgba(99,102,241,0.15)" }}>
            {["login", "register"].map(m => (
              <button key={m} onClick={() => setMode(m)} className={`tab-btn ${mode === m ? "active" : ""}`} style={{ flex: 1, textTransform: "capitalize" }}>{m === "login" ? "Sign In" : "Register"}</button>
            ))}
          </div>

          <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
            {mode === "register" && (
              <div>
                <label style={{ fontSize: 12, color: "#64748b", marginBottom: 6, display: "block", fontWeight: 500 }}>Full Name</label>
                <input className="input" value={form.name} onChange={e => setForm(p => ({ ...p, name: e.target.value }))} placeholder="John Smith" style={{ width: "100%", borderRadius: 10, padding: "10px 14px", fontSize: 14 }} />
              </div>
            )}
            <div>
              <label style={{ fontSize: 12, color: "#64748b", marginBottom: 6, display: "block", fontWeight: 500 }}>Email Address</label>
              <div style={{ position: "relative" }}>
                <Mail size={14} style={{ position: "absolute", left: 12, top: "50%", transform: "translateY(-50%)", color: "#475569" }} />
                <input className="input" value={form.email} onChange={e => setForm(p => ({ ...p, email: e.target.value }))} placeholder="you@company.com" type="email" style={{ width: "100%", borderRadius: 10, padding: "10px 14px 10px 36px", fontSize: 14 }} />
              </div>
            </div>
            <div>
              <label style={{ fontSize: 12, color: "#64748b", marginBottom: 6, display: "block", fontWeight: 500 }}>Password</label>
              <div style={{ position: "relative" }}>
                <Lock size={14} style={{ position: "absolute", left: 12, top: "50%", transform: "translateY(-50%)", color: "#475569" }} />
                <input className="input" value={form.password} onChange={e => setForm(p => ({ ...p, password: e.target.value }))} placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" type={showPw ? "text" : "password"} style={{ width: "100%", borderRadius: 10, padding: "10px 40px 10px 36px", fontSize: 14 }} />
                <button onClick={() => setShowPw(!showPw)} style={{ position: "absolute", right: 12, top: "50%", transform: "translateY(-50%)", background: "none", border: "none", cursor: "pointer", color: "#475569" }}>
                  {showPw ? <EyeOff size={14} /> : <Eye size={14} />}
                </button>
              </div>
            </div>
            {mode === "register" && (
              <div>
                <label style={{ fontSize: 12, color: "#64748b", marginBottom: 6, display: "block", fontWeight: 500 }}>Role</label>
                <select className="input" value={form.role} onChange={e => setForm(p => ({ ...p, role: e.target.value }))} style={{ width: "100%", borderRadius: 10, padding: "10px 14px", fontSize: 14 }}>
                  {["Admin", "HR", "Auditor"].map(r => <option key={r} value={r}>{r}</option>)}
                </select>
              </div>
            )}
            {error && <div style={{ padding: "10px 14px", borderRadius: 8, background: "rgba(239,68,68,0.1)", border: "1px solid rgba(239,68,68,0.3)", color: "#fca5a5", fontSize: 13 }}>{error}</div>}
            <button className="btn-primary" onClick={submit} disabled={loading} style={{ width: "100%", padding: "12px", borderRadius: 10, fontSize: 14, justifyContent: "center" }}>
              {loading ? <Spinner size={15} /> : <Shield size={15} />}
              {loading ? "Authenticating..." : mode === "login" ? "Access Platform" : "Create Account"}
            </button>
          </div>

          <p style={{ textAlign: "center", marginTop: 20, fontSize: 12, color: "#334155" }}>
            Demo: admin@hireguard.ai / any password
          </p>
        </div>
      </div>
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const Dashboard = ({ user, token }) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // Load mock data instantly + try API
    setData({
      metrics: { overallRisk: 47, totalInterviews: 124, totalResumes: 89, totalSkillMatches: 56, avgBiasScore: 38, avgAIScore: 62, highRiskInterviews: 14, complianceRate: 87 },
      trendData: MOCK_TREND,
      departmentBreakdown: MOCK_DEPT,
      recentInterviews: MOCK_INTERVIEWS.slice(0, 4),
      recentResumes: MOCK_RESUMES.slice(0, 3)
    });
    setLoading(false);

    if (token !== "demo-token") {
      fetch(`${API_BASE}/records/dashboard`, { headers: { Authorization: `Bearer ${token}` } })
        .then(r => r.json()).then(d => { if (d.success) setData(d); }).catch(() => {});
    }
  }, [token]);

  if (loading || !data) return <div style={{ display: "flex", alignItems: "center", justifyContent: "center", height: "100%", gap: 12 }}><Spinner size={24} /><span style={{ color: "#64748b" }}>Loading dashboard...</span></div>;

  const { metrics } = data;

  return (
    <div className="fade-up" style={{ height: "100%", overflowY: "auto", padding: "24px 28px" }}>
      <SectionHeader title="Executive Dashboard">
        <div style={{ display: "flex", alignItems: "center", gap: 6, padding: "5px 12px", borderRadius: 8, background: "rgba(16,185,129,0.08)", border: "1px solid rgba(16,185,129,0.25)" }}>
          <div style={{ width: 7, height: 7, borderRadius: "50%", background: "#10b981" }} className="pulse" />
          <span style={{ fontSize: 11, color: "#10b981", fontFamily: "JetBrains Mono" }}>LIVE MONITORING</span>
        </div>
      </SectionHeader>

      {/* Metric Cards */}
      <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 16, marginBottom: 24 }}>
        <MetricCard icon={Shield} label="Overall Risk Score" value={metrics.overallRisk} sub={riskLabel(metrics.overallRisk)} color={riskColor(metrics.overallRisk)} trend={-8} delay={0} />
        <MetricCard icon={AlertTriangle} label="Avg Bias Score" value={`${metrics.avgBiasScore}%`} sub="Across all interviews" color="#f59e0b" trend={-12} delay={0.05} />
        <MetricCard icon={FileSearch} label="Resume Auth Score" value={`${100 - metrics.avgAIScore}%`} sub="Human authenticity" color="#10b981" trend={5} delay={0.1} />
        <MetricCard icon={Activity} label="Compliance Rate" value={`${metrics.complianceRate}%`} sub="EEOC/SHRM alignment" color="#6366f1" trend={3} delay={0.15} />
      </div>

      <div style={{ display: "grid", gridTemplateColumns: "2fr 1fr", gap: 20, marginBottom: 20 }}>
        {/* Risk Trend Chart */}
        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">RISK TREND ‚Äî 8 WEEKS</div>
          <ResponsiveContainer width="100%" height={200}>
            <AreaChart data={data.trendData}>
              <defs>
                {[["bias", "#f59e0b"], ["fraud", "#ef4444"], ["risk", "#6366f1"]].map(([k, c]) => (
                  <linearGradient key={k} id={`g_${k}`} x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor={c} stopOpacity={0.25} />
                    <stop offset="95%" stopColor={c} stopOpacity={0} />
                  </linearGradient>
                ))}
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke="rgba(99,102,241,0.07)" />
              <XAxis dataKey="week" stroke="#334155" tick={{ fill: "#64748b", fontSize: 11, fontFamily: "JetBrains Mono" }} />
              <YAxis stroke="#334155" tick={{ fill: "#64748b", fontSize: 11, fontFamily: "JetBrains Mono" }} />
              <Tooltip content={<TooltipContent />} />
              <Legend wrapperStyle={{ fontSize: 11, fontFamily: "JetBrains Mono", color: "#64748b" }} />
              <Area type="monotone" dataKey="risk" name="Risk" stroke="#6366f1" fill="url(#g_risk)" strokeWidth={2} />
              <Area type="monotone" dataKey="bias" name="Bias" stroke="#f59e0b" fill="url(#g_bias)" strokeWidth={2} />
              <Area type="monotone" dataKey="fraud" name="AI Fraud" stroke="#ef4444" fill="url(#g_fraud)" strokeWidth={1.5} />
            </AreaChart>
          </ResponsiveContainer>
        </div>

        {/* Overall Risk Ring */}
        <div className="card" style={{ padding: 20, display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center" }}>
          <div className="section-label" style={{ alignSelf: "flex-start" }}>OVERALL RISK INDEX</div>
          <ScoreRing score={metrics.overallRisk} size={140} />
          <div style={{ marginTop: 16, textAlign: "center" }}>
            <Badge level={riskLabel(metrics.overallRisk).split(" ")[0].toLowerCase()} label={riskLabel(metrics.overallRisk)} />
            <div style={{ marginTop: 12, display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, textAlign: "center" }}>
              {[["Interviews", metrics.totalInterviews], ["High Risk", metrics.highRiskInterviews], ["Resumes", metrics.totalResumes], ["Skill Matches", metrics.totalSkillMatches]].map(([l, v]) => (
                <div key={l} style={{ padding: "8px", borderRadius: 8, background: "rgba(15,23,42,0.5)", border: "1px solid rgba(99,102,241,0.1)" }}>
                  <div className="metric-value" style={{ fontSize: 18, color: "white" }}>{v}</div>
                  <div style={{ fontSize: 10, color: "#475569", fontFamily: "JetBrains Mono" }}>{l}</div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>

      <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20, marginBottom: 20 }}>
        {/* Department Heatmap */}
        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">DEPARTMENT RISK HEATMAP</div>
          <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
            {data.departmentBreakdown.map(d => (
              <div key={d.dept}>
                <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 4 }}>
                  <span style={{ fontSize: 12, color: "#94a3b8" }}>{d.dept}</span>
                  <span style={{ fontSize: 12, fontFamily: "JetBrains Mono", color: riskColor(d.score), fontWeight: 600 }}>{d.score}</span>
                </div>
                <div className="risk-bar">
                  <div className="risk-bar-fill" style={{ width: `${d.score}%`, background: riskColor(d.score), boxShadow: `0 0 8px ${riskColor(d.score)}50` }} />
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Recent Activity */}
        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">RECENT INTERVIEW AUDITS</div>
          <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
            {data.recentInterviews.map(r => (
              <div key={r._id} style={{ display: "flex", alignItems: "center", gap: 12, padding: "8px 10px", borderRadius: 8, background: "rgba(15,23,42,0.4)", border: "1px solid rgba(99,102,241,0.08)" }}>
                <div style={{ width: 32, height: 32, borderRadius: 8, background: `${riskFromLabel(r.riskLevel)}15`, border: `1px solid ${riskFromLabel(r.riskLevel)}30`, display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 }}>
                  <span style={{ fontSize: 12, fontWeight: 700, color: riskFromLabel(r.riskLevel), fontFamily: "JetBrains Mono" }}>{r.biasScore}</span>
                </div>
                <div style={{ flex: 1, minWidth: 0 }}>
                  <div style={{ fontSize: 13, color: "#e2e8f0", fontWeight: 500, overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap" }}>{r.recruiterName}</div>
                  <div style={{ fontSize: 11, color: "#475569" }}>{r.department} ¬∑ {r.candidateName}</div>
                </div>
                <Badge level={r.riskLevel.toLowerCase()} label={r.riskLevel} />
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* Pie Charts Row */}
      <div style={{ display: "grid", gridTemplateColumns: "repeat(3, 1fr)", gap: 20 }}>
        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">RISK DISTRIBUTION</div>
          <ResponsiveContainer width="100%" height={160}>
            <PieChart>
              <Pie data={[{ name: "Low", value: 45 }, { name: "Moderate", value: 30 }, { name: "High", value: 18 }, { name: "Critical", value: 7 }]} cx="50%" cy="50%" innerRadius={40} outerRadius={65} paddingAngle={3} dataKey="value">
                {[COLORS.risk.low, COLORS.risk.moderate, COLORS.risk.high, COLORS.risk.critical].map((c, i) => <Cell key={i} fill={c} />)}
              </Pie>
              <Tooltip content={<TooltipContent />} />
            </PieChart>
          </ResponsiveContainer>
        </div>
        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">BIAS TYPE BREAKDOWN</div>
          <ResponsiveContainer width="100%" height={160}>
            <BarChart data={[{ type: "Gender", val: 38 }, { type: "Age", val: 29 }, { type: "Nation", val: 18 }, { type: "Religion", val: 9 }, { type: "Other", val: 6 }]}>
              <XAxis dataKey="type" tick={{ fill: "#64748b", fontSize: 10, fontFamily: "JetBrains Mono" }} stroke="#1e293b" />
              <YAxis tick={{ fill: "#64748b", fontSize: 10 }} stroke="#1e293b" />
              <Tooltip content={<TooltipContent />} />
              <Bar dataKey="val" radius={[4, 4, 0, 0]}>
                {COLORS.chart.map((c, i) => <Cell key={i} fill={c} />)}
              </Bar>
            </BarChart>
          </ResponsiveContainer>
        </div>
        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">RESUME AUTHENTICITY</div>
          <ResponsiveContainer width="100%" height={160}>
            <PieChart>
              <Pie data={[{ name: "Likely Human", value: 52 }, { name: "Mixed", value: 21 }, { name: "Likely AI", value: 19 }, { name: "Certainly AI", value: 8 }]} cx="50%" cy="50%" innerRadius={40} outerRadius={65} paddingAngle={3} dataKey="value">
                {[COLORS.risk.low, COLORS.risk.moderate, COLORS.risk.high, COLORS.risk.critical].map((c, i) => <Cell key={i} fill={c} />)}
              </Pie>
              <Tooltip content={<TooltipContent />} />
            </PieChart>
          </ResponsiveContainer>
        </div>
      </div>
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ INTERVIEW BIAS AUDIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const InterviewBiasAudit = ({ user, token }) => {
  const [transcript, setTranscript] = useState("");
  const [recruiterName, setRecruiterName] = useState("");
  const [department, setDepartment] = useState("Engineering");
  const [candidateName, setCandidateName] = useState("");
  const [analyzing, setAnalyzing] = useState(false);
  const [result, setResult] = useState(null);
  const [error, setError] = useState("");
  const [records, setRecords] = useState(MOCK_INTERVIEWS);
  const [search, setSearch] = useState("");
  const [tab, setTab] = useState("analyze");
  const [savingId, setSavingId] = useState(null);
  const [deletingId, setDeletingId] = useState(null);

  const callAnthropicDirect = async (text) => {
    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        system: `You are an expert HR bias detection system. Analyze interview transcripts for discriminatory patterns.
Respond ONLY with valid JSON: {"flaggedPhrases":[{"text":"...","biasType":"gender|age|religion|nationality|caste|disability","severity":"mild|moderate|severe","suggestedRephrase":"..."}],"overallScore":0-100,"complianceIssues":["..."],"recruiterTips":["..."],"summary":"..."}
overallScore: 0=no bias, 100=extreme bias.`,
        messages: [{ role: "user", content: `Analyze this interview transcript for bias:\n\n${text}` }]
      })
    });
    const data = await response.json();
    const text2 = data.content?.map(b => b.text || "").join("") || "";
    return JSON.parse(text2.replace(/```json\n?|```/g, "").trim());
  };

  const analyze = async () => {
    if (!transcript.trim()) return;
    setAnalyzing(true); setError(""); setResult(null);
    try {
      let data;
      if (token !== "demo-token") {
        try {
          const res = await fetch(`${API_BASE}/analyze/interview`, {
            method: "POST",
            headers: { "Content-Type": "application/json", Authorization: `Bearer ${token}` },
            body: JSON.stringify({ transcript, recruiterName, department, candidateName })
          });
          const json = await res.json();
          if (json.success) { setResult(json.analysis); return; }
        } catch (e) {}
      }
      data = await callAnthropicDirect(transcript);
      setResult(data);
    } catch (e) { setError("Analysis failed. Ensure Anthropic API key is configured, or the backend is running."); }
    setAnalyzing(false);
  };

  const saveAudit = async () => {
    if (!result) return;
    setSavingId("saving");
    await new Promise(r => setTimeout(r, 800));
    const newRecord = {
      _id: Date.now().toString(),
      recruiterName: recruiterName || user.name,
      department,
      candidateName: candidateName || "Anonymous",
      biasScore: result.overallScore,
      riskLevel: result.overallScore < 25 ? "Low" : result.overallScore < 50 ? "Moderate" : result.overallScore < 75 ? "High" : "Critical",
      status: "Pending",
      createdAt: new Date().toISOString()
    };
    setRecords(p => [newRecord, ...p]);
    setSavingId(null);
    setTab("records");
  };

  const deleteRecord = async (id) => {
    setDeletingId(id);
    if (token !== "demo-token") {
      try {
        await fetch(`${API_BASE}/records/interview/${id}`, { method: "DELETE", headers: { Authorization: `Bearer ${token}` } });
      } catch (e) {}
    }
    await new Promise(r => setTimeout(r, 400));
    setRecords(p => p.filter(r => r._id !== id));
    setDeletingId(null);
  };

  const exportCSV = () => {
    const csv = "Date,Recruiter,Department,Candidate,Bias Score,Risk Level,Status\n" +
      records.map(r => `${r.createdAt.split("T")[0]},"${r.recruiterName}","${r.department}","${r.candidateName}",${r.biasScore},${r.riskLevel},${r.status}`).join("\n");
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a"); a.href = url; a.download = "interview-audits.csv"; a.click();
  };

  const filtered = records.filter(r =>
    !search || r.recruiterName.toLowerCase().includes(search.toLowerCase()) || r.candidateName?.toLowerCase().includes(search.toLowerCase())
  );

  return (
    <div className="fade-up" style={{ height: "100%", overflowY: "auto", padding: "24px 28px" }}>
      <SectionHeader title="Interview Bias Audit">
        <div style={{ display: "flex", gap: 8 }}>
          {["analyze", "records"].map(t => (
            <button key={t} className={`tab-btn ${tab === t ? "active" : ""}`} onClick={() => setTab(t)}>
              {t === "analyze" ? "üîç Analyze" : `üìã Records (${records.length})`}
            </button>
          ))}
        </div>
      </SectionHeader>

      {tab === "analyze" ? (
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1.2fr", gap: 20 }}>
          {/* Input Panel */}
          <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
            <div className="card" style={{ padding: 20 }}>
              <div className="section-label">INTERVIEW DETAILS</div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 12 }}>
                <div>
                  <label style={{ fontSize: 12, color: "#64748b", marginBottom: 6, display: "block" }}>Recruiter Name</label>
                  <input className="input" value={recruiterName} onChange={e => setRecruiterName(e.target.value)} placeholder={user.name} style={{ width: "100%", borderRadius: 8, padding: "8px 12px", fontSize: 13 }} />
                </div>
                <div>
                  <label style={{ fontSize: 12, color: "#64748b", marginBottom: 6, display: "block" }}>Department</label>
                  <select className="input" value={department} onChange={e => setDepartment(e.target.value)} style={{ width: "100%", borderRadius: 8, padding: "8px 12px", fontSize: 13 }}>
                    {["Engineering", "Sales", "HR", "Design", "Operations", "Legal", "Marketing", "Finance"].map(d => <option key={d}>{d}</option>)}
                  </select>
                </div>
                <div style={{ gridColumn: "1/-1" }}>
                  <label style={{ fontSize: 12, color: "#64748b", marginBottom: 6, display: "block" }}>Candidate Name (optional)</label>
                  <input className="input" value={candidateName} onChange={e => setCandidateName(e.target.value)} placeholder="Anonymous" style={{ width: "100%", borderRadius: 8, padding: "8px 12px", fontSize: 13 }} />
                </div>
              </div>

              <label style={{ fontSize: 12, color: "#64748b", marginBottom: 6, display: "block" }}>Interview Transcript</label>
              <textarea className="input" value={transcript} onChange={e => setTranscript(e.target.value)} placeholder="Paste interview transcript here..." style={{ width: "100%", borderRadius: 8, padding: "10px 12px", fontSize: 13, minHeight: 180 }} />

              <div style={{ display: "flex", gap: 8, marginTop: 12 }}>
                <button className="btn-secondary" onClick={() => setTranscript(DEMO_TRANSCRIPT)} style={{ padding: "8px 14px", borderRadius: 8, fontSize: 13 }}>
                  <Zap size={13} /> Load Demo
                </button>
                <button className="btn-primary" onClick={analyze} disabled={analyzing || !transcript.trim()} style={{ flex: 1, padding: "10px", borderRadius: 8, fontSize: 13, justifyContent: "center" }}>
                  {analyzing ? <><Spinner size={14} /> Analyzing...</> : <><Brain size={14} /> Analyze for Bias</>}
                </button>
              </div>
              {error && <div style={{ marginTop: 10, padding: "8px 12px", borderRadius: 8, background: "rgba(239,68,68,0.1)", border: "1px solid rgba(239,68,68,0.3)", color: "#fca5a5", fontSize: 12 }}>{error}</div>}
            </div>
          </div>

          {/* Results Panel */}
          <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
            {!result && !analyzing && (
              <div className="card" style={{ padding: 40, textAlign: "center", display: "flex", flexDirection: "column", alignItems: "center", gap: 12 }}>
                <Brain size={40} style={{ color: "#334155" }} />
                <p style={{ color: "#475569" }}>Analyze a transcript to see results</p>
              </div>
            )}
            {analyzing && (
              <div className="card" style={{ padding: 40, textAlign: "center", display: "flex", flexDirection: "column", alignItems: "center", gap: 16 }}>
                <div className="float"><Brain size={40} style={{ color: "#6366f1" }} /></div>
                <p style={{ color: "#a5b4fc" }}>AI analyzing transcript...</p>
                <div style={{ display: "flex", gap: 4 }}>
                  {[0, 0.15, 0.3].map((d, i) => <div key={i} className="pulse" style={{ width: 8, height: 8, borderRadius: "50%", background: "#6366f1", animationDelay: `${d}s` }} />)}
                </div>
              </div>
            )}
            {result && (
              <div className="scale-in" style={{ display: "flex", flexDirection: "column", gap: 14 }}>
                {/* Score Card */}
                <div className="card" style={{ padding: 20, display: "flex", gap: 20, alignItems: "center" }}>
                  <ScoreRing score={result.overallScore} size={90} />
                  <div style={{ flex: 1 }}>
                    <div style={{ fontSize: 13, color: "#64748b", marginBottom: 6 }}>BIAS ANALYSIS COMPLETE</div>
                    <div style={{ fontSize: 20, fontWeight: 700, color: riskColor(result.overallScore), marginBottom: 6 }}>{riskLabel(result.overallScore)}</div>
                    <div style={{ fontSize: 13, color: "#94a3b8", marginBottom: 10 }}>{result.flaggedPhrases?.length || 0} issues ‚Ä¢ {result.complianceIssues?.length || 0} compliance risks</div>
                    <div style={{ display: "flex", gap: 8 }}>
                      <button className="btn-success" onClick={saveAudit} disabled={!!savingId} style={{ padding: "7px 12px", borderRadius: 8, fontSize: 12 }}>
                        {savingId ? <Spinner size={12} /> : <Save size={12} />} Save Audit
                      </button>
                    </div>
                  </div>
                </div>

                {/* Summary */}
                <div className="card" style={{ padding: 16 }}>
                  <div className="section-label">AI SUMMARY</div>
                  <p style={{ fontSize: 13, color: "#94a3b8", lineHeight: 1.6 }}>{result.summary}</p>
                </div>

                {/* Flagged Phrases */}
                {result.flaggedPhrases?.length > 0 && (
                  <div className="card" style={{ padding: 16 }}>
                    <div className="section-label">FLAGGED PHRASES ({result.flaggedPhrases.length})</div>
                    <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
                      {result.flaggedPhrases.map((p, i) => (
                        <div key={i} style={{ padding: 12, borderRadius: 8, background: "rgba(239,68,68,0.06)", border: "1px solid rgba(239,68,68,0.2)" }}>
                          <div style={{ display: "flex", gap: 8, alignItems: "flex-start", marginBottom: 8 }}>
                            <AlertTriangle size={13} style={{ color: "#ef4444", marginTop: 2, flexShrink: 0 }} />
                            <span style={{ fontSize: 13, color: "#fca5a5", fontStyle: "italic" }}>"{p.text}"</span>
                            <div style={{ display: "flex", gap: 4, marginLeft: "auto", flexShrink: 0 }}>
                              <Badge level={p.biasType} label={p.biasType} />
                              <Badge level={p.severity} label={p.severity} />
                            </div>
                          </div>
                          <div style={{ display: "flex", alignItems: "flex-start", gap: 8, padding: "8px 10px", borderRadius: 6, background: "rgba(16,185,129,0.06)", border: "1px solid rgba(16,185,129,0.15)" }}>
                            <CheckCircle size={12} style={{ color: "#10b981", marginTop: 2, flexShrink: 0 }} />
                            <span style={{ fontSize: 12, color: "#6ee7b7" }}>{p.suggestedRephrase}</span>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* Compliance Issues */}
                {result.complianceIssues?.length > 0 && (
                  <div className="card" style={{ padding: 14 }}>
                    <div className="section-label">EEOC/SHRM VIOLATIONS</div>
                    {result.complianceIssues.map((c, i) => (
                      <div key={i} style={{ display: "flex", gap: 8, padding: "6px 0", borderBottom: i < result.complianceIssues.length - 1 ? "1px solid rgba(239,68,68,0.1)" : "none" }}>
                        <XCircle size={13} style={{ color: "#ef4444", flexShrink: 0, marginTop: 2 }} />
                        <span style={{ fontSize: 12, color: "#fca5a5" }}>{c}</span>
                      </div>
                    ))}
                  </div>
                )}

                {/* Recruiter Tips */}
                {result.recruiterTips?.length > 0 && (
                  <div className="card" style={{ padding: 14 }}>
                    <div className="section-label">COACHING RECOMMENDATIONS</div>
                    {result.recruiterTips.map((t, i) => (
                      <div key={i} style={{ display: "flex", gap: 8, padding: "6px 0", borderBottom: i < result.recruiterTips.length - 1 ? "1px solid rgba(99,102,241,0.1)" : "none" }}>
                        <Zap size={13} style={{ color: "#6366f1", flexShrink: 0, marginTop: 2 }} />
                        <span style={{ fontSize: 12, color: "#a5b4fc" }}>{t}</span>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      ) : (
        <div>
          <div style={{ display: "flex", gap: 12, marginBottom: 16, alignItems: "center" }}>
            <div style={{ position: "relative", flex: 1 }}>
              <Search size={14} style={{ position: "absolute", left: 12, top: "50%", transform: "translateY(-50%)", color: "#475569" }} />
              <input className="input" value={search} onChange={e => setSearch(e.target.value)} placeholder="Search by recruiter or candidate..." style={{ width: "100%", borderRadius: 8, padding: "8px 12px 8px 34px", fontSize: 13 }} />
            </div>
            <button className="btn-secondary" onClick={exportCSV} style={{ padding: "8px 14px", borderRadius: 8, fontSize: 13 }}>
              <Download size={13} /> Export CSV
            </button>
          </div>

          <div className="card" style={{ overflow: "hidden" }}>
            <table className="table">
              <thead>
                <tr>
                  <th>Date</th><th>Recruiter</th><th>Department</th><th>Candidate</th><th>Bias Score</th><th>Risk Level</th><th>Status</th><th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {filtered.map(r => (
                  <tr key={r._id}>
                    <td style={{ fontFamily: "JetBrains Mono", fontSize: 12 }}>{new Date(r.createdAt).toLocaleDateString()}</td>
                    <td style={{ fontWeight: 500, color: "#e2e8f0" }}>{r.recruiterName}</td>
                    <td>{r.department}</td>
                    <td>{r.candidateName}</td>
                    <td>
                      <span style={{ fontFamily: "JetBrains Mono", fontWeight: 700, color: riskFromLabel(r.riskLevel) }}>{r.biasScore}</span>
                    </td>
                    <td><Badge level={r.riskLevel.toLowerCase()} label={r.riskLevel} /></td>
                    <td><Badge level={r.status.toLowerCase()} label={r.status} /></td>
                    <td>
                      <button className="btn-danger" onClick={() => deleteRecord(r._id)} disabled={deletingId === r._id} style={{ padding: "5px 10px", borderRadius: 6, fontSize: 12 }}>
                        {deletingId === r._id ? <Spinner size={12} /> : <Trash2 size={12} />}
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
            {filtered.length === 0 && <div style={{ padding: 40, textAlign: "center", color: "#475569" }}>No records found</div>}
          </div>
        </div>
      )}
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ RESUME INTELLIGENCE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const ResumeIntelligence = ({ user, token }) => {
  const [resumeText, setResumeText] = useState("");
  const [candidateName, setCandidateName] = useState("");
  const [position, setPosition] = useState("");
  const [dragging, setDragging] = useState(false);
  const [filename, setFilename] = useState("");
  const [analyzing, setAnalyzing] = useState(false);
  const [result, setResult] = useState(null);
  const [error, setError] = useState("");
  const [records, setRecords] = useState(MOCK_RESUMES);
  const [tab, setTab] = useState("analyze");
  const [deletingId, setDeletingId] = useState(null);
  const fileRef = useRef();

  const callAnthropicDirect = async (text) => {
    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        system: `You are an AI content detection expert. Detect AI-generated content signals in resumes.
Respond ONLY with valid JSON: {"aiProbabilityScore":0-100,"classification":"Likely Human|Mixed|Likely AI-Generated|Almost Certainly AI","sectionScores":{"summary":0-100,"experience":0-100,"skills":0-100,"education":0-100},"highlightedPhrases":[{"text":"...","reason":"..."}],"humanizationTips":["..."],"plagiarismFlags":["..."],"voiceFingerprint":{"formal":0-100,"casual":0-100,"technical":0-100,"creative":0-100}}`,
        messages: [{ role: "user", content: `Analyze this resume:\n\n${text}` }]
      })
    });
    const data = await response.json();
    const t = data.content?.map(b => b.text || "").join("") || "";
    return JSON.parse(t.replace(/```json\n?|```/g, "").trim());
  };

  const analyze = async () => {
    if (!resumeText.trim()) return;
    setAnalyzing(true); setError(""); setResult(null);
    try {
      const data = await callAnthropicDirect(resumeText);
      setResult(data);
      setRecords(p => [{ _id: Date.now().toString(), candidateName: candidateName || "Unknown", position: position || "Unspecified", aiProbabilityScore: data.aiProbabilityScore, classification: data.classification, status: "Pending", createdAt: new Date().toISOString() }, ...p]);
    } catch (e) { setError("Analysis failed. Check API configuration."); }
    setAnalyzing(false);
  };

  const handleFile = async (file) => {
    if (!file) return;
    if (file.type !== "application/pdf") { setError("Only PDF files are allowed"); return; }
    setFilename(file.name);
    setResumeText(`[PDF: ${file.name}]\n\n` + DEMO_RESUME); // Fallback: show demo text since we can't parse PDF in browser
  };

  const deleteRecord = (id) => {
    setDeletingId(id);
    setTimeout(() => { setRecords(p => p.filter(r => r._id !== id)); setDeletingId(null); }, 400);
  };

  const classificationColor = (cls) => ({ "Likely Human": "#10b981", "Mixed": "#f59e0b", "Likely AI-Generated": "#ef4444", "Almost Certainly AI": "#dc2626" }[cls] || "#94a3b8");

  return (
    <div className="fade-up" style={{ height: "100%", overflowY: "auto", padding: "24px 28px" }}>
      <SectionHeader title="Resume Intelligence">
        <div style={{ display: "flex", gap: 8 }}>
          {["analyze", "records"].map(t => (
            <button key={t} className={`tab-btn ${tab === t ? "active" : ""}`} onClick={() => setTab(t)}>
              {t === "analyze" ? "üîç Analyze" : `üìã Records (${records.length})`}
            </button>
          ))}
        </div>
      </SectionHeader>

      {tab === "analyze" ? (
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1.2fr", gap: 20 }}>
          <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
            <div className="card" style={{ padding: 20 }}>
              <div className="section-label">CANDIDATE DETAILS</div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 14 }}>
                <div>
                  <label style={{ fontSize: 12, color: "#64748b", marginBottom: 5, display: "block" }}>Candidate Name</label>
                  <input className="input" value={candidateName} onChange={e => setCandidateName(e.target.value)} placeholder="Full name" style={{ width: "100%", borderRadius: 8, padding: "8px 10px", fontSize: 13 }} />
                </div>
                <div>
                  <label style={{ fontSize: 12, color: "#64748b", marginBottom: 5, display: "block" }}>Position Applied</label>
                  <input className="input" value={position} onChange={e => setPosition(e.target.value)} placeholder="Job title" style={{ width: "100%", borderRadius: 8, padding: "8px 10px", fontSize: 13 }} />
                </div>
              </div>

              {/* Upload Zone */}
              <div className={`drag-zone ${dragging ? "dragging" : ""}`}
                onDragOver={e => { e.preventDefault(); setDragging(true); }}
                onDragLeave={() => setDragging(false)}
                onDrop={e => { e.preventDefault(); setDragging(false); handleFile(e.dataTransfer.files[0]); }}
                onClick={() => fileRef.current?.click()}
                style={{ marginBottom: 12 }}>
                <input ref={fileRef} type="file" accept=".pdf" style={{ display: "none" }} onChange={e => handleFile(e.target.files[0])} />
                <Upload size={24} style={{ color: filename ? "#10b981" : "#475569", margin: "0 auto 8px" }} />
                <p style={{ fontSize: 13, color: filename ? "#10b981" : "#64748b" }}>{filename || "Drop PDF resume or click to browse"}</p>
                <p style={{ fontSize: 11, color: "#334155", marginTop: 4 }}>PDF only ¬∑ Max 10MB</p>
              </div>

              <div style={{ position: "relative", marginBottom: 10 }}>
                <div style={{ position: "absolute", inset: 0, display: "flex", alignItems: "center" }}>
                  <div style={{ flex: 1, borderTop: "1px solid rgba(99,102,241,0.15)" }} />
                  <span style={{ padding: "0 10px", fontSize: 11, color: "#475569" }}>OR PASTE TEXT</span>
                  <div style={{ flex: 1, borderTop: "1px solid rgba(99,102,241,0.15)" }} />
                </div>
              </div>
              <div style={{ marginTop: 14 }}>
                <textarea className="input" value={resumeText} onChange={e => setResumeText(e.target.value)} placeholder="Paste resume text here..." style={{ width: "100%", borderRadius: 8, padding: "10px 12px", fontSize: 12, minHeight: 150 }} />
              </div>

              <div style={{ display: "flex", gap: 8, marginTop: 10 }}>
                <button className="btn-secondary" onClick={() => { setResumeText(DEMO_RESUME); setFilename(""); }} style={{ padding: "8px 12px", borderRadius: 8, fontSize: 13 }}>
                  <Zap size={13} /> Demo
                </button>
                <button className="btn-primary" onClick={analyze} disabled={analyzing || !resumeText.trim()} style={{ flex: 1, padding: "10px", borderRadius: 8, fontSize: 13, justifyContent: "center" }}>
                  {analyzing ? <><Spinner size={14} /> Scanning...</> : <><FileSearch size={14} /> Detect AI Content</>}
                </button>
              </div>
              {error && <div style={{ marginTop: 10, padding: "8px 12px", borderRadius: 8, background: "rgba(239,68,68,0.1)", color: "#fca5a5", fontSize: 12 }}>{error}</div>}
            </div>
          </div>

          {/* Results */}
          <div>
            {!result && !analyzing && (
              <div className="card" style={{ padding: 40, textAlign: "center", display: "flex", flexDirection: "column", alignItems: "center", gap: 12 }}>
                <FileSearch size={40} style={{ color: "#334155" }} />
                <p style={{ color: "#475569" }}>Upload or paste a resume to analyze</p>
              </div>
            )}
            {analyzing && (
              <div className="card" style={{ padding: 40, textAlign: "center" }}>
                <div className="float" style={{ marginBottom: 16 }}><Cpu size={40} style={{ color: "#6366f1" }} /></div>
                <p style={{ color: "#a5b4fc" }}>Scanning for AI patterns...</p>
              </div>
            )}
            {result && (
              <div className="scale-in" style={{ display: "flex", flexDirection: "column", gap: 14 }}>
                {/* Score */}
                <div className="card" style={{ padding: 20 }}>
                  <div style={{ display: "flex", alignItems: "center", gap: 20 }}>
                    <div style={{ textAlign: "center" }}>
                      <div style={{ fontSize: 48, fontWeight: 800, color: classificationColor(result.classification), fontFamily: "JetBrains Mono", lineHeight: 1 }}>{result.aiProbabilityScore}%</div>
                      <div style={{ fontSize: 11, color: "#64748b", fontFamily: "JetBrains Mono" }}>AI PROBABILITY</div>
                    </div>
                    <div style={{ flex: 1 }}>
                      <div style={{ fontSize: 18, fontWeight: 700, color: classificationColor(result.classification), marginBottom: 8 }}>{result.classification}</div>
                      <div style={{ height: 8, borderRadius: 4, background: "rgba(30,41,59,0.8)", marginBottom: 10 }}>
                        <div style={{ height: "100%", borderRadius: 4, width: `${result.aiProbabilityScore}%`, background: `linear-gradient(90deg, #10b981, ${classificationColor(result.classification)})`, transition: "width 1.5s ease", boxShadow: `0 0 8px ${classificationColor(result.classification)}60` }} />
                      </div>
                      <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 6 }}>
                        {Object.entries(result.sectionScores || {}).map(([k, v]) => (
                          <div key={k} style={{ padding: "6px 10px", borderRadius: 6, background: "rgba(15,23,42,0.5)", border: "1px solid rgba(99,102,241,0.1)", display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                            <span style={{ fontSize: 11, color: "#64748b", textTransform: "capitalize" }}>{k}</span>
                            <span style={{ fontSize: 12, fontWeight: 700, color: riskColor(v), fontFamily: "JetBrains Mono" }}>{v}%</span>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>

                {/* Voice Fingerprint Radar */}
                {result.voiceFingerprint && (
                  <div className="card" style={{ padding: 16 }}>
                    <div className="section-label">VOICE FINGERPRINT</div>
                    <ResponsiveContainer width="100%" height={160}>
                      <RadarChart data={Object.entries(result.voiceFingerprint).map(([k, v]) => ({ trait: k.charAt(0).toUpperCase() + k.slice(1), value: v }))}>
                        <PolarGrid stroke="rgba(99,102,241,0.15)" />
                        <PolarAngleAxis dataKey="trait" tick={{ fill: "#64748b", fontSize: 11, fontFamily: "JetBrains Mono" }} />
                        <Radar dataKey="value" stroke="#6366f1" fill="#6366f1" fillOpacity={0.2} strokeWidth={2} />
                      </RadarChart>
                    </ResponsiveContainer>
                  </div>
                )}

                {/* Highlighted Phrases */}
                {result.highlightedPhrases?.length > 0 && (
                  <div className="card" style={{ padding: 14 }}>
                    <div className="section-label">AI-INDICATIVE PHRASES</div>
                    {result.highlightedPhrases.slice(0, 4).map((p, i) => (
                      <div key={i} style={{ display: "flex", gap: 8, padding: "7px 0", borderBottom: "1px solid rgba(99,102,241,0.06)" }}>
                        <AlertTriangle size={12} style={{ color: "#f59e0b", flexShrink: 0, marginTop: 2 }} />
                        <div>
                          <div style={{ fontSize: 12, color: "#fbbf24", marginBottom: 2 }}>"{p.text}"</div>
                          <div style={{ fontSize: 11, color: "#64748b" }}>{p.reason}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}

                {/* Humanization Tips */}
                {result.humanizationTips?.length > 0 && (
                  <div className="card" style={{ padding: 14 }}>
                    <div className="section-label">HUMANIZATION TIPS</div>
                    {result.humanizationTips.map((t, i) => (
                      <div key={i} style={{ display: "flex", gap: 8, padding: "5px 0" }}>
                        <CheckCircle size={12} style={{ color: "#10b981", flexShrink: 0, marginTop: 2 }} />
                        <span style={{ fontSize: 12, color: "#6ee7b7" }}>{t}</span>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      ) : (
        <div className="card" style={{ overflow: "hidden" }}>
          <table className="table">
            <thead>
              <tr><th>Date</th><th>Candidate</th><th>Position</th><th>AI Score</th><th>Classification</th><th>Status</th><th>Actions</th></tr>
            </thead>
            <tbody>
              {records.map(r => (
                <tr key={r._id}>
                  <td style={{ fontFamily: "JetBrains Mono", fontSize: 12 }}>{new Date(r.createdAt).toLocaleDateString()}</td>
                  <td style={{ fontWeight: 500, color: "#e2e8f0" }}>{r.candidateName}</td>
                  <td>{r.position}</td>
                  <td><span style={{ fontFamily: "JetBrains Mono", fontWeight: 700, color: classificationColor(r.classification) }}>{r.aiProbabilityScore}%</span></td>
                  <td><span style={{ fontSize: 12, color: classificationColor(r.classification) }}>{r.classification}</span></td>
                  <td><Badge level={r.status.toLowerCase()} label={r.status} /></td>
                  <td>
                    <button className="btn-danger" onClick={() => deleteRecord(r._id)} disabled={deletingId === r._id} style={{ padding: "5px 10px", borderRadius: 6, fontSize: 12 }}>
                      {deletingId === r._id ? <Spinner size={12} /> : <Trash2 size={12} />}
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ SKILL MATCH ENGINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SkillMatchEngine = ({ user, token }) => {
  const [jobDesc, setJobDesc] = useState("");
  const [resumeText, setResumeText] = useState("");
  const [candidateName, setCandidateName] = useState("");
  const [position, setPosition] = useState("");
  const [analyzing, setAnalyzing] = useState(false);
  const [result, setResult] = useState(null);
  const [error, setError] = useState("");
  const [records, setRecords] = useState([
    { _id: "1", candidateName: "Arjun Mehta", position: "Sr. Engineer", matchScore: 94, classification: "Excellent Fit", createdAt: new Date().toISOString() },
    { _id: "2", candidateName: "Sarah Chen", position: "PM", matchScore: 71, classification: "Moderate Fit", createdAt: new Date().toISOString() },
  ]);

  const callAnthropicDirect = async (jd, rt) => {
    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        system: `You are a skill matching expert. Compare job requirements to candidate resume.
Respond ONLY with valid JSON: {"matchScore":0-100,"classification":"Excellent Fit|Strong Fit|Moderate Fit|Weak Fit|Poor Fit","matchedSkills":["..."],"missingSkills":["..."],"suggestedQuestions":["..."],"fitSummary":"..."}`,
        messages: [{ role: "user", content: `Job Description:\n${jd}\n\nCandidate Resume:\n${rt}` }]
      })
    });
    const data = await response.json();
    const t = data.content?.map(b => b.text || "").join("") || "";
    return JSON.parse(t.replace(/```json\n?|```/g, "").trim());
  };

  const analyze = async () => {
    if (!jobDesc.trim() || !resumeText.trim()) return;
    setAnalyzing(true); setError(""); setResult(null);
    try {
      const data = await callAnthropicDirect(jobDesc, resumeText);
      setResult(data);
      setRecords(p => [{ _id: Date.now().toString(), candidateName: candidateName || "Unknown", position: position || "Unspecified", matchScore: data.matchScore, classification: data.classification, createdAt: new Date().toISOString() }, ...p]);
    } catch (e) { setError("Match analysis failed."); }
    setAnalyzing(false);
  };

  const classColor = (cls) => ({ "Excellent Fit": "#10b981", "Strong Fit": "#34d399", "Moderate Fit": "#f59e0b", "Weak Fit": "#ef4444", "Poor Fit": "#dc2626" }[cls] || "#94a3b8");

  return (
    <div className="fade-up" style={{ height: "100%", overflowY: "auto", padding: "24px 28px" }}>
      <SectionHeader title="Skill Match Engine" />

      <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20, marginBottom: 20 }}>
        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">JOB DESCRIPTION</div>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 10 }}>
            <div>
              <label style={{ fontSize: 12, color: "#64748b", marginBottom: 5, display: "block" }}>Candidate</label>
              <input className="input" value={candidateName} onChange={e => setCandidateName(e.target.value)} placeholder="Name" style={{ width: "100%", borderRadius: 8, padding: "7px 10px", fontSize: 13 }} />
            </div>
            <div>
              <label style={{ fontSize: 12, color: "#64748b", marginBottom: 5, display: "block" }}>Position</label>
              <input className="input" value={position} onChange={e => setPosition(e.target.value)} placeholder="Job title" style={{ width: "100%", borderRadius: 8, padding: "7px 10px", fontSize: 13 }} />
            </div>
          </div>
          <textarea className="input" value={jobDesc} onChange={e => setJobDesc(e.target.value)} placeholder="Paste job description here..." style={{ width: "100%", borderRadius: 8, padding: "10px", fontSize: 13, minHeight: 120 }} />
          <button className="btn-secondary" style={{ marginTop: 8, padding: "6px 12px", borderRadius: 8, fontSize: 12 }}
            onClick={() => setJobDesc("Senior Software Engineer with 5+ years of React, Node.js, TypeScript. Experience with AWS, Docker, Kubernetes. Strong problem solving skills. Bachelor's in CS or equivalent.")}>
            <Zap size={12} /> Demo JD
          </button>
        </div>

        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">CANDIDATE RESUME</div>
          <textarea className="input" value={resumeText} onChange={e => setResumeText(e.target.value)} placeholder="Paste candidate resume text..." style={{ width: "100%", borderRadius: 8, padding: "10px", fontSize: 13, minHeight: 145 }} />
          <div style={{ display: "flex", gap: 8, marginTop: 8 }}>
            <button className="btn-secondary" style={{ padding: "6px 12px", borderRadius: 8, fontSize: 12 }} onClick={() => setResumeText(DEMO_RESUME)}>
              <Zap size={12} /> Demo Resume
            </button>
            <button className="btn-primary" onClick={analyze} disabled={analyzing || !jobDesc.trim() || !resumeText.trim()} style={{ flex: 1, padding: "8px", borderRadius: 8, fontSize: 13, justifyContent: "center" }}>
              {analyzing ? <><Spinner size={14} /> Matching...</> : <><Target size={14} /> Run Skill Match</>}
            </button>
          </div>
          {error && <div style={{ marginTop: 8, padding: "8px 10px", borderRadius: 7, background: "rgba(239,68,68,0.1)", color: "#fca5a5", fontSize: 12 }}>{error}</div>}
        </div>
      </div>

      {result && (
        <div className="scale-in" style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 16, marginBottom: 20 }}>
          <div className="card" style={{ padding: 20, textAlign: "center" }}>
            <ScoreRing score={result.matchScore} size={110} />
            <div style={{ marginTop: 12, fontSize: 16, fontWeight: 700, color: classColor(result.classification) }}>{result.classification}</div>
            <p style={{ fontSize: 12, color: "#64748b", marginTop: 8 }}>{result.fitSummary}</p>
          </div>

          <div className="card" style={{ padding: 16 }}>
            <div className="section-label">MATCHED SKILLS ‚úì</div>
            <div style={{ display: "flex", flexWrap: "wrap", gap: 6 }}>
              {result.matchedSkills?.map((s, i) => (
                <span key={i} style={{ padding: "3px 9px", borderRadius: 5, background: "rgba(16,185,129,0.1)", border: "1px solid rgba(16,185,129,0.25)", color: "#10b981", fontSize: 12 }}>{s}</span>
              ))}
            </div>
            <div className="section-label" style={{ marginTop: 14 }}>MISSING SKILLS ‚úó</div>
            <div style={{ display: "flex", flexWrap: "wrap", gap: 6 }}>
              {result.missingSkills?.map((s, i) => (
                <span key={i} style={{ padding: "3px 9px", borderRadius: 5, background: "rgba(239,68,68,0.08)", border: "1px solid rgba(239,68,68,0.2)", color: "#fca5a5", fontSize: 12 }}>{s}</span>
              ))}
            </div>
          </div>

          <div className="card" style={{ padding: 16 }}>
            <div className="section-label">SUGGESTED QUESTIONS</div>
            {result.suggestedQuestions?.map((q, i) => (
              <div key={i} style={{ display: "flex", gap: 8, padding: "6px 0", borderBottom: "1px solid rgba(99,102,241,0.07)" }}>
                <Zap size={12} style={{ color: "#6366f1", flexShrink: 0, marginTop: 2 }} />
                <span style={{ fontSize: 12, color: "#a5b4fc" }}>{q}</span>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Records Table */}
      <div className="card" style={{ overflow: "hidden" }}>
        <div style={{ padding: "14px 20px", borderBottom: "1px solid rgba(99,102,241,0.1)" }}>
          <div className="section-label" style={{ marginBottom: 0 }}>MATCH HISTORY</div>
        </div>
        <table className="table">
          <thead>
            <tr><th>Candidate</th><th>Position</th><th>Match Score</th><th>Classification</th><th>Date</th></tr>
          </thead>
          <tbody>
            {records.map(r => (
              <tr key={r._id}>
                <td style={{ fontWeight: 500, color: "#e2e8f0" }}>{r.candidateName}</td>
                <td>{r.position}</td>
                <td>
                  <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                    <span style={{ fontFamily: "JetBrains Mono", fontWeight: 700, color: classColor(r.classification), width: 35 }}>{r.matchScore}%</span>
                    <div style={{ flex: 1, height: 5, borderRadius: 3, background: "rgba(30,41,59,0.8)" }}>
                      <div style={{ height: "100%", borderRadius: 3, width: `${r.matchScore}%`, background: classColor(r.classification) }} />
                    </div>
                  </div>
                </td>
                <td style={{ color: classColor(r.classification), fontSize: 12 }}>{r.classification}</td>
                <td style={{ fontFamily: "JetBrains Mono", fontSize: 11, color: "#475569" }}>{new Date(r.createdAt).toLocaleDateString()}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ TREND ANALYTICS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TrendAnalytics = ({ user, token }) => {
  const leaderboard = [
    { name: "Alex Chen", dept: "Engineering", avg: 12, sessions: 18 },
    { name: "Emma Wilson", dept: "Design", avg: 19, sessions: 11 },
    { name: "David Wu", dept: "Legal", avg: 22, sessions: 7 },
    { name: "James Park", dept: "Operations", avg: 35, sessions: 20 },
    { name: "Maria Santos", dept: "Sales", avg: 52, sessions: 15 },
    { name: "Sarah Kim", dept: "HR", avg: 61, sessions: 9 },
  ];

  return (
    <div className="fade-up" style={{ height: "100%", overflowY: "auto", padding: "24px 28px" }}>
      <SectionHeader title="Trend Analytics" />

      <div style={{ display: "grid", gridTemplateColumns: "2fr 1fr", gap: 20, marginBottom: 20 }}>
        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">BIAS & FRAUD TREND (8 WEEKS)</div>
          <ResponsiveContainer width="100%" height={220}>
            <LineChart data={MOCK_TREND}>
              <CartesianGrid strokeDasharray="3 3" stroke="rgba(99,102,241,0.07)" />
              <XAxis dataKey="week" stroke="#334155" tick={{ fill: "#64748b", fontSize: 11, fontFamily: "JetBrains Mono" }} />
              <YAxis stroke="#334155" tick={{ fill: "#64748b", fontSize: 11, fontFamily: "JetBrains Mono" }} domain={[0, 100]} />
              <Tooltip content={<TooltipContent />} />
              <Legend wrapperStyle={{ fontSize: 11, color: "#64748b" }} />
              <Line type="monotone" dataKey="bias" name="Bias Score" stroke="#f59e0b" strokeWidth={2.5} dot={{ r: 4, fill: "#f59e0b" }} />
              <Line type="monotone" dataKey="fraud" name="AI Fraud" stroke="#ef4444" strokeWidth={2} dot={{ r: 3 }} strokeDasharray="5 5" />
              <Line type="monotone" dataKey="risk" name="Overall Risk" stroke="#6366f1" strokeWidth={2} dot={{ r: 3 }} />
            </LineChart>
          </ResponsiveContainer>
        </div>

        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">RECRUITER LEADERBOARD (LOWEST BIAS)</div>
          <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
            {leaderboard.map((r, i) => (
              <div key={i} style={{ display: "flex", alignItems: "center", gap: 10 }}>
                <span style={{ fontSize: 12, color: "#475569", fontFamily: "JetBrains Mono", width: 18, textAlign: "right" }}>{i + 1}</span>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: 12, color: "#e2e8f0", fontWeight: 500 }}>{r.name}</div>
                  <div style={{ fontSize: 10, color: "#475569" }}>{r.dept} ¬∑ {r.sessions} sessions</div>
                </div>
                <span style={{ fontFamily: "JetBrains Mono", fontSize: 13, fontWeight: 700, color: riskColor(r.avg), width: 28, textAlign: "right" }}>{r.avg}</span>
              </div>
            ))}
          </div>
        </div>
      </div>

      <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20, marginBottom: 20 }}>
        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">DEPARTMENT RISK COMPARISON</div>
          <ResponsiveContainer width="100%" height={200}>
            <BarChart data={MOCK_DEPT} layout="vertical">
              <XAxis type="number" domain={[0, 100]} tick={{ fill: "#64748b", fontSize: 10, fontFamily: "JetBrains Mono" }} stroke="#1e293b" />
              <YAxis type="category" dataKey="dept" tick={{ fill: "#64748b", fontSize: 11, fontFamily: "JetBrains Mono" }} stroke="#1e293b" width={80} />
              <Tooltip content={<TooltipContent />} />
              <Bar dataKey="score" name="Bias Score" radius={[0, 4, 4, 0]}>
                {MOCK_DEPT.map((d, i) => <Cell key={i} fill={riskColor(d.score)} />)}
              </Bar>
            </BarChart>
          </ResponsiveContainer>
        </div>

        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">PREDICTIVE COMPLIANCE FORECAST</div>
          <ResponsiveContainer width="100%" height={200}>
            <AreaChart data={[...MOCK_TREND, { week: "W9", bias: 24, fraud: 12, risk: 27 }, { week: "W10", bias: 20, fraud: 10, risk: 23 }]}>
              <defs>
                <linearGradient id="compG" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="5%" stopColor="#10b981" stopOpacity={0.2} />
                  <stop offset="95%" stopColor="#10b981" stopOpacity={0} />
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke="rgba(99,102,241,0.07)" />
              <XAxis dataKey="week" stroke="#334155" tick={{ fill: "#64748b", fontSize: 11, fontFamily: "JetBrains Mono" }} />
              <YAxis stroke="#334155" tick={{ fill: "#64748b", fontSize: 11 }} />
              <Tooltip content={<TooltipContent />} />
              <Area type="monotone" dataKey="risk" name="Risk (Forecast)" stroke="#10b981" fill="url(#compG)" strokeWidth={2} strokeDasharray="8 3" />
            </AreaChart>
          </ResponsiveContainer>
          <p style={{ fontSize: 11, color: "#10b981", marginTop: 8 }}>‚Üì Compliance on track to reach 93% by Q1 2025</p>
        </div>
      </div>

      {/* Audit Timeline */}
      <div className="card" style={{ padding: 20 }}>
        <div className="section-label">HISTORICAL AUDIT TIMELINE</div>
        <div style={{ display: "flex", flexDirection: "column", gap: 0 }}>
          {[
            { date: "Dec 15, 2024", event: "Q4 Compliance Audit Completed ‚Äî 87% compliance rate achieved", type: "success" },
            { date: "Dec 10, 2024", event: "Critical bias flagged ‚Äî Recruiter Sarah Kim, Sales dept interview #482", type: "critical" },
            { date: "Dec 5, 2024", event: "DEI Score improved to 81% (+12% vs Q3)", type: "success" },
            { date: "Nov 28, 2024", event: "3 AI-generated resumes detected in Engineering batch screening", type: "warning" },
            { date: "Nov 20, 2024", event: "EEOC training triggered for 2 recruiters based on audit findings", type: "info" },
            { date: "Nov 15, 2024", event: "New bias detection model deployed ‚Äî 23% improvement in accuracy", type: "info" },
          ].map((e, i) => (
            <div key={i} style={{ display: "flex", gap: 16, padding: "12px 0", borderBottom: "1px solid rgba(99,102,241,0.07)" }}>
              <div style={{ display: "flex", flexDirection: "column", alignItems: "center", width: 16 }}>
                <div style={{ width: 10, height: 10, borderRadius: "50%", flexShrink: 0, background: { success: "#10b981", critical: "#ef4444", warning: "#f59e0b", info: "#6366f1" }[e.type] }} />
                {i < 5 && <div style={{ flex: 1, width: 1, background: "rgba(99,102,241,0.15)", marginTop: 4 }} />}
              </div>
              <div>
                <div style={{ fontSize: 13, color: "#e2e8f0", marginBottom: 2 }}>{e.event}</div>
                <div style={{ fontSize: 11, color: "#475569", fontFamily: "JetBrains Mono" }}>{e.date}</div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ REPORTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const Reports = ({ user, token }) => {
  const [generating, setGenerating] = useState(false);
  const [reports, setReports] = useState([
    { _id: "1", title: "Q4 2024 Executive Report", type: "Executive", fileSize: 248000, createdAt: new Date().toISOString() },
    { _id: "2", title: "November Bias Audit Report", type: "Interview", fileSize: 182000, createdAt: new Date(Date.now() - 86400000 * 15).toISOString() },
  ]);
  const [deletingId, setDeletingId] = useState(null);

  const generateReport = async () => {
    setGenerating(true);
    if (token !== "demo-token") {
      try {
        const res = await fetch(`${API_BASE}/reports/generate`, {
          method: "POST",
          headers: { "Content-Type": "application/json", Authorization: `Bearer ${token}` },
          body: JSON.stringify({ type: "Executive", title: `Executive Report ‚Äî ${new Date().toLocaleDateString()}` })
        });
        const data = await res.json();
        if (data.success) { setReports(p => [data.report, ...p]); setGenerating(false); return; }
      } catch (e) {}
    }
    // Demo: generate client-side CSV-style report download
    await new Promise(r => setTimeout(r, 1500));
    const newReport = { _id: Date.now().toString(), title: `Executive Report ‚Äî ${new Date().toLocaleDateString()}`, type: "Executive", fileSize: Math.floor(Math.random() * 200000 + 100000), createdAt: new Date().toISOString() };
    setReports(p => [newReport, ...p]);
    setGenerating(false);
  };

  const downloadReport = (report) => {
    if (token !== "demo-token") { window.open(`${API_BASE}/reports/${report._id}/download?token=${token}`, "_blank"); return; }
    // Demo download
    const content = `HireGuard AI - ${report.title}\n\nGenerated: ${new Date().toLocaleString()}\n\nEXECUTIVE SUMMARY\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nOverall Risk Score: 47/100 ‚Äî Moderate\nTotal Interviews: 124\nAvg Bias Score: 38%\nCompliance Rate: 87%\nHigh Risk Incidents: 14\n\nKEY FINDINGS\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n1. 124 interview sessions analyzed in the reporting period\n2. Average bias score: 38/100 ‚Äî Moderate Risk\n3. 14 interviews classified as High/Critical risk\n4. EEOC compliance rate: 87%\n5. 89 resume authenticity checks performed\n6. 11 resumes flagged as likely AI-generated\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nHireGuard AI ‚Äî Confidential\n`;
    const blob = new Blob([content], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a"); a.href = url; a.download = `${report.title}.txt`; a.click();
  };

  const deleteReport = (id) => {
    setDeletingId(id);
    setTimeout(() => { setReports(p => p.filter(r => r._id !== id)); setDeletingId(null); }, 400);
  };

  return (
    <div className="fade-up" style={{ height: "100%", overflowY: "auto", padding: "24px 28px" }}>
      <SectionHeader title="Enterprise Reports">
        <button className="btn-primary" onClick={generateReport} disabled={generating} style={{ padding: "9px 18px", borderRadius: 9, fontSize: 13 }}>
          {generating ? <><Spinner size={14} /> Generating...</> : <><FileBarChart size={14} /> Generate Report</>}
        </button>
      </SectionHeader>

      {/* Summary Cards */}
      <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 16, marginBottom: 24 }}>
        {[
          { icon: Shield, label: "Overall Risk", value: "47 / 100", color: "#f59e0b" },
          { icon: Users, label: "Sessions Analyzed", value: "124", color: "#6366f1" },
          { icon: CheckCircle, label: "Compliance Rate", value: "87%", color: "#10b981" },
          { icon: AlertTriangle, label: "Legal Exposure", value: "Low", color: "#10b981" }
        ].map((c, i) => (
          <MetricCard key={i} icon={c.icon} label={c.label} value={c.value} color={c.color} delay={i * 0.05} />
        ))}
      </div>

      {/* Compliance Breakdown */}
      <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20, marginBottom: 20 }}>
        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">COMPLIANCE BREAKDOWN</div>
          {[
            { label: "EEOC Compliance", score: 89, color: "#10b981" },
            { label: "SHRM Standards", score: 84, color: "#6366f1" },
            { label: "ADA Compliance", score: 92, color: "#10b981" },
            { label: "Title VII", score: 78, color: "#f59e0b" },
            { label: "ADEA (Age)", score: 71, color: "#f59e0b" },
          ].map((c, i) => (
            <div key={i} style={{ marginBottom: 10 }}>
              <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 4 }}>
                <span style={{ fontSize: 12, color: "#94a3b8" }}>{c.label}</span>
                <span style={{ fontSize: 12, fontFamily: "JetBrains Mono", color: c.color, fontWeight: 700 }}>{c.score}%</span>
              </div>
              <div className="risk-bar">
                <div className="risk-bar-fill" style={{ width: `${c.score}%`, background: c.color }} />
              </div>
            </div>
          ))}
        </div>

        <div className="card" style={{ padding: 20 }}>
          <div className="section-label">AI EXPLAINABILITY</div>
          {[
            { flag: "Age bias detected in Question #3", reason: "Explicit age preference violates ADEA ¬ß4(a)(1)", conf: 96 },
            { flag: "Resume #482 classified AI-generated", reason: "Buzzword density 3.4√ó baseline; no personal anecdotes", conf: 74 },
            { flag: "DEI score penalized ‚Äî Engineering dept", reason: "9:1 male-to-female interview ratio in Q4 cohort", conf: 88 },
          ].map((e, i) => (
            <div key={i} style={{ padding: "10px 0", borderBottom: "1px solid rgba(99,102,241,0.1)" }}>
              <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 4 }}>
                <span style={{ fontSize: 12, color: "#a5b4fc", fontWeight: 500 }}>{e.flag}</span>
                <span style={{ fontSize: 11, color: "#6366f1", fontFamily: "JetBrains Mono", background: "rgba(99,102,241,0.15)", padding: "1px 6px", borderRadius: 5 }}>{e.conf}%</span>
              </div>
              <span style={{ fontSize: 11, color: "#64748b" }}>{e.reason}</span>
            </div>
          ))}
        </div>
      </div>

      {/* Reports List */}
      <div className="card" style={{ overflow: "hidden" }}>
        <div style={{ padding: "14px 20px", borderBottom: "1px solid rgba(99,102,241,0.1)" }}>
          <div className="section-label" style={{ marginBottom: 0 }}>GENERATED REPORTS</div>
        </div>
        <table className="table">
          <thead>
            <tr><th>Title</th><th>Type</th><th>Size</th><th>Generated</th><th>Actions</th></tr>
          </thead>
          <tbody>
            {reports.map(r => (
              <tr key={r._id}>
                <td style={{ fontWeight: 500, color: "#e2e8f0" }}>{r.title}</td>
                <td><Badge level="pending" label={r.type} /></td>
                <td style={{ fontFamily: "JetBrains Mono", fontSize: 12 }}>{(r.fileSize / 1024).toFixed(0)} KB</td>
                <td style={{ fontFamily: "JetBrains Mono", fontSize: 11, color: "#475569" }}>{new Date(r.createdAt).toLocaleDateString()}</td>
                <td>
                  <div style={{ display: "flex", gap: 6 }}>
                    <button className="btn-success" onClick={() => downloadReport(r)} style={{ padding: "5px 10px", borderRadius: 6, fontSize: 12 }}>
                      <Download size={12} /> Download
                    </button>
                    <button className="btn-secondary" onClick={() => window.confirm("Email sent!") && null} style={{ padding: "5px 10px", borderRadius: 6, fontSize: 12 }}>
                      <Mail size={12} /> Email
                    </button>
                    <button className="btn-danger" onClick={() => deleteReport(r._id)} disabled={deletingId === r._id} style={{ padding: "5px 8px", borderRadius: 6, fontSize: 12 }}>
                      {deletingId === r._id ? <Spinner size={12} /> : <Trash2 size={12} />}
                    </button>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ ADMIN PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const AdminPanel = ({ user, token }) => {
  const [users, setUsers] = useState(MOCK_USERS);
  const [showModal, setShowModal] = useState(false);
  const [form, setForm] = useState({ name: "", email: "", password: "", role: "HR", department: "" });
  const [saving, setSaving] = useState(false);
  const [deletingId, setDeletingId] = useState(null);

  if (user.role !== "Admin") {
    return (
      <div className="fade-up" style={{ height: "100%", display: "flex", alignItems: "center", justifyContent: "center" }}>
        <div style={{ textAlign: "center", color: "#475569" }}>
          <Shield size={48} style={{ margin: "0 auto 16px", color: "#334155" }} />
          <p style={{ fontSize: 16 }}>Admin access required</p>
        </div>
      </div>
    );
  }

  const createUser = async () => {
    setSaving(true);
    await new Promise(r => setTimeout(r, 600));
    setUsers(p => [{ _id: Date.now().toString(), ...form, isActive: true, lastLogin: null, createdAt: new Date().toISOString() }, ...p]);
    setShowModal(false);
    setSaving(false);
    setForm({ name: "", email: "", password: "", role: "HR", department: "" });
  };

  const deleteUser = (id) => {
    if (id === "1") return alert("Cannot delete admin user");
    setDeletingId(id);
    setTimeout(() => { setUsers(p => p.filter(u => u._id !== id)); setDeletingId(null); }, 400);
  };

  return (
    <div className="fade-up" style={{ height: "100%", overflowY: "auto", padding: "24px 28px" }}>
      <SectionHeader title="Admin Panel">
        <button className="btn-primary" onClick={() => setShowModal(true)} style={{ padding: "9px 16px", borderRadius: 9, fontSize: 13 }}>
          <Plus size={14} /> Add User
        </button>
      </SectionHeader>

      <div style={{ display: "grid", gridTemplateColumns: "repeat(3, 1fr)", gap: 16, marginBottom: 24 }}>
        <MetricCard icon={Users} label="Total Users" value={users.length} color="#6366f1" />
        <MetricCard icon={Activity} label="Active Sessions" value={3} color="#10b981" />
        <MetricCard icon={Database} label="Total Audits" value={213} color="#f59e0b" />
      </div>

      <div className="card" style={{ overflow: "hidden", marginBottom: 20 }}>
        <div style={{ padding: "14px 20px", borderBottom: "1px solid rgba(99,102,241,0.1)" }}>
          <div className="section-label" style={{ marginBottom: 0 }}>USER MANAGEMENT</div>
        </div>
        <table className="table">
          <thead>
            <tr><th>Name</th><th>Email</th><th>Role</th><th>Department</th><th>Status</th><th>Last Login</th><th>Actions</th></tr>
          </thead>
          <tbody>
            {users.map(u => (
              <tr key={u._id}>
                <td style={{ fontWeight: 500, color: "#e2e8f0" }}>{u.name}</td>
                <td style={{ fontFamily: "JetBrains Mono", fontSize: 12, color: "#94a3b8" }}>{u.email}</td>
                <td><Badge level={u.role === "Admin" ? "critical" : u.role === "HR" ? "moderate" : "low"} label={u.role} /></td>
                <td>{u.department || "‚Äî"}</td>
                <td><Badge level={u.isActive ? "reviewed" : "pending"} label={u.isActive ? "Active" : "Inactive"} /></td>
                <td style={{ fontFamily: "JetBrains Mono", fontSize: 11, color: "#475569" }}>{u.lastLogin ? new Date(u.lastLogin).toLocaleDateString() : "Never"}</td>
                <td>
                  <button className="btn-danger" onClick={() => deleteUser(u._id)} disabled={deletingId === u._id} style={{ padding: "5px 8px", borderRadius: 6, fontSize: 12 }}>
                    {deletingId === u._id ? <Spinner size={12} /> : <Trash2 size={12} />}
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {/* Activity Logs */}
      <div className="card" style={{ padding: 20 }}>
        <div className="section-label">SYSTEM ACTIVITY LOGS</div>
        {[
          { action: "INTERVIEW_ANALYZED", user: "Maria Santos", time: "2 min ago", color: "#6366f1" },
          { action: "RESUME_FLAGGED", user: "Alex Chen", time: "18 min ago", color: "#f59e0b" },
          { action: "REPORT_GENERATED", user: "Admin User", time: "1h ago", color: "#10b981" },
          { action: "USER_REGISTERED", user: "System", time: "3h ago", color: "#06b6d4" },
          { action: "RECORD_DELETED", user: "James Park", time: "5h ago", color: "#ef4444" },
        ].map((l, i) => (
          <div key={i} style={{ display: "flex", alignItems: "center", gap: 12, padding: "8px 0", borderBottom: "1px solid rgba(99,102,241,0.07)" }}>
            <span style={{ padding: "3px 8px", borderRadius: 5, background: `${l.color}15`, color: l.color, fontSize: 10, fontFamily: "JetBrains Mono", fontWeight: 600 }}>{l.action}</span>
            <span style={{ flex: 1, fontSize: 12, color: "#94a3b8" }}>{l.user}</span>
            <span style={{ fontSize: 11, color: "#475569", fontFamily: "JetBrains Mono" }}>{l.time}</span>
          </div>
        ))}
      </div>

      {showModal && (
        <div className="modal-overlay" onClick={() => setShowModal(false)}>
          <div className="modal" style={{ padding: 28, width: 440 }} onClick={e => e.stopPropagation()}>
            <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 20 }}>
              <h3 style={{ fontSize: 17, fontWeight: 700, color: "white" }}>Create User</h3>
              <button onClick={() => setShowModal(false)} style={{ background: "none", border: "none", cursor: "pointer", color: "#64748b" }}><X size={18} /></button>
            </div>
            <div style={{ display: "flex", flexDirection: "column", gap: 14 }}>
              {[{ l: "Full Name", k: "name", ph: "John Smith" }, { l: "Email", k: "email", ph: "john@company.com", t: "email" }, { l: "Password", k: "password", ph: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢", t: "password" }, { l: "Department", k: "department", ph: "Engineering" }].map(f => (
                <div key={f.k}>
                  <label style={{ fontSize: 12, color: "#64748b", marginBottom: 5, display: "block" }}>{f.l}</label>
                  <input className="input" type={f.t || "text"} value={form[f.k]} onChange={e => setForm(p => ({ ...p, [f.k]: e.target.value }))} placeholder={f.ph} style={{ width: "100%", borderRadius: 8, padding: "9px 12px", fontSize: 13 }} />
                </div>
              ))}
              <div>
                <label style={{ fontSize: 12, color: "#64748b", marginBottom: 5, display: "block" }}>Role</label>
                <select className="input" value={form.role} onChange={e => setForm(p => ({ ...p, role: e.target.value }))} style={{ width: "100%", borderRadius: 8, padding: "9px 12px", fontSize: 13 }}>
                  {["Admin", "HR", "Auditor"].map(r => <option key={r}>{r}</option>)}
                </select>
              </div>
              <button className="btn-primary" onClick={createUser} disabled={saving} style={{ padding: "11px", borderRadius: 9, justifyContent: "center", width: "100%" }}>
                {saving ? <><Spinner size={14} /> Creating...</> : <><Plus size={14} /> Create User</>}
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SettingsPanel = ({ user, token, isDark, toggleTheme, onLogout }) => {
  const [notifications, setNotifications] = useState(true);
  const [autoSave, setAutoSave] = useState(true);
  const [emailReports, setEmailReports] = useState(false);
  const [saving, setSaving] = useState(false);

  const Toggle = ({ val, set, label }) => (
    <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "12px 0", borderBottom: "1px solid rgba(99,102,241,0.08)" }}>
      <span style={{ fontSize: 13, color: "#94a3b8" }}>{label}</span>
      <button onClick={() => set(!val)} style={{ width: 44, height: 24, borderRadius: 12, border: "none", cursor: "pointer", position: "relative", background: val ? "linear-gradient(135deg, #6366f1, #8b5cf6)" : "rgba(30,41,59,0.8)", transition: "all 0.2s", outline: "1px solid rgba(99,102,241,0.3)" }}>
        <div style={{ width: 18, height: 18, borderRadius: "50%", background: val ? "white" : "rgba(148,163,184,0.5)", position: "absolute", top: 3, left: val ? "calc(100% - 21px)" : "3px", transition: "all 0.2s" }} />
      </button>
    </div>
  );

  const save = async () => { setSaving(true); await new Promise(r => setTimeout(r, 800)); setSaving(false); };

  return (
    <div className="fade-up" style={{ height: "100%", overflowY: "auto", padding: "24px 28px" }}>
      <SectionHeader title="Settings" />

      <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20 }}>
        <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
          <div className="card" style={{ padding: 20 }}>
            <div className="section-label">PROFILE</div>
            <div style={{ display: "flex", alignItems: "center", gap: 14, marginBottom: 18, padding: 14, borderRadius: 10, background: "rgba(99,102,241,0.06)", border: "1px solid rgba(99,102,241,0.15)" }}>
              <div style={{ width: 48, height: 48, borderRadius: "50%", background: "linear-gradient(135deg, rgba(99,102,241,0.4), rgba(139,92,246,0.3))", display: "flex", alignItems: "center", justifyContent: "center", border: "1px solid rgba(99,102,241,0.4)", fontSize: 20, color: "#a5b4fc", fontWeight: 700 }}>
                {user.name[0]}
              </div>
              <div>
                <div style={{ fontSize: 15, color: "white", fontWeight: 600 }}>{user.name}</div>
                <div style={{ fontSize: 12, color: "#64748b" }}>{user.email}</div>
                <Badge level={user.role.toLowerCase()} label={user.role} />
              </div>
            </div>
            <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
              {[{ l: "Full Name", v: user.name }, { l: "Email", v: user.email }, { l: "Department", v: user.department || "Platform" }].map(f => (
                <div key={f.l}>
                  <label style={{ fontSize: 12, color: "#64748b", marginBottom: 5, display: "block" }}>{f.l}</label>
                  <input className="input" defaultValue={f.v} style={{ width: "100%", borderRadius: 8, padding: "8px 12px", fontSize: 13 }} />
                </div>
              ))}
            </div>
          </div>

          <div className="card" style={{ padding: 20 }}>
            <div className="section-label">APPEARANCE</div>
            <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "12px 0" }}>
              <span style={{ fontSize: 13, color: "#94a3b8" }}>Dark Mode</span>
              <button onClick={toggleTheme} style={{ width: 44, height: 24, borderRadius: 12, border: "none", cursor: "pointer", position: "relative", background: isDark ? "linear-gradient(135deg, #6366f1, #8b5cf6)" : "rgba(30,41,59,0.8)", transition: "all 0.2s", outline: "1px solid rgba(99,102,241,0.3)" }}>
                <div style={{ width: 18, height: 18, borderRadius: "50%", background: isDark ? "white" : "rgba(148,163,184,0.5)", position: "absolute", top: 3, left: isDark ? "calc(100% - 21px)" : "3px", transition: "all 0.2s" }} />
              </button>
            </div>
          </div>
        </div>

        <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
          <div className="card" style={{ padding: 20 }}>
            <div className="section-label">PREFERENCES</div>
            <Toggle val={notifications} set={setNotifications} label="Push Notifications" />
            <Toggle val={autoSave} set={setAutoSave} label="Auto-Save Audits" />
            <Toggle val={emailReports} set={setEmailReports} label="Email Reports Weekly" />
            <div style={{ marginTop: 16, display: "flex", gap: 10 }}>
              <button className="btn-primary" onClick={save} disabled={saving} style={{ flex: 1, padding: "10px", borderRadius: 9, fontSize: 13, justifyContent: "center" }}>
                {saving ? <><Spinner size={14} /> Saving...</> : <><Save size={13} /> Save Preferences</>}
              </button>
            </div>
          </div>

          <div className="card" style={{ padding: 20 }}>
            <div className="section-label">API CONFIGURATION</div>
            <div>
              <label style={{ fontSize: 12, color: "#64748b", marginBottom: 5, display: "block" }}>Backend URL</label>
              <input className="input" defaultValue={API_BASE} style={{ width: "100%", borderRadius: 8, padding: "8px 12px", fontSize: 12, fontFamily: "JetBrains Mono" }} />
            </div>
            <div style={{ marginTop: 10 }}>
              <label style={{ fontSize: 12, color: "#64748b", marginBottom: 5, display: "block" }}>Anthropic API Key</label>
              <input className="input" placeholder="sk-ant-..." type="password" style={{ width: "100%", borderRadius: 8, padding: "8px 12px", fontSize: 12, fontFamily: "JetBrains Mono" }} />
            </div>
            <p style={{ fontSize: 11, color: "#334155", marginTop: 8 }}>Configure in backend .env file for production</p>
          </div>

          <div className="card" style={{ padding: 20 }}>
            <div className="section-label">DANGER ZONE</div>
            <button className="btn-danger" onClick={onLogout} style={{ width: "100%", padding: "10px", borderRadius: 9, fontSize: 13, justifyContent: "center" }}>
              <LogOut size={13} /> Sign Out
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

// ‚îÄ‚îÄ‚îÄ MAIN APP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
export default function HireGuardAI() {
  const [auth, setAuth] = useState(null);
  const [page, setPage] = useState("dashboard");
  const [isDark, setIsDark] = useState(true);
  const [notifications] = useState(2);
  const [showNotifPanel, setShowNotifPanel] = useState(false);

  const navItems = [
    { id: "dashboard", icon: LayoutDashboard, label: "Dashboard" },
    { id: "bias", icon: Brain, label: "Interview Bias Audit" },
    { id: "resume", icon: FileText, label: "Resume Intelligence" },
    { id: "skills", icon: Target, label: "Skill Match Engine" },
    { id: "analytics", icon: TrendingUp, label: "Trend Analytics" },
    { id: "reports", icon: FileBarChart, label: "Reports" },
    { id: "admin", icon: Users, label: "Admin Panel" },
    { id: "settings", icon: Settings, label: "Settings" },
  ];

  const pageComponents = {
    dashboard: <Dashboard user={auth?.user} token={auth?.token} />,
    bias: <InterviewBiasAudit user={auth?.user} token={auth?.token} />,
    resume: <ResumeIntelligence user={auth?.user} token={auth?.token} />,
    skills: <SkillMatchEngine user={auth?.user} token={auth?.token} />,
    analytics: <TrendAnalytics user={auth?.user} token={auth?.token} />,
    reports: <Reports user={auth?.user} token={auth?.token} />,
    admin: <AdminPanel user={auth?.user} token={auth?.token} />,
    settings: <SettingsPanel user={auth?.user} token={auth?.token} isDark={isDark} toggleTheme={() => setIsDark(!isDark)} onLogout={() => setAuth(null)} />,
  };

  if (!auth) return (
    <>
      <style>{GLOBAL_CSS}</style>
      <AuthScreen onLogin={(token, user) => setAuth({ token, user })} />
    </>
  );

  return (
    <>
      <style>{GLOBAL_CSS}</style>
      <div style={{ display: "flex", height: "100vh", background: isDark ? "#0B1426" : "#f1f5f9", overflow: "hidden", position: "relative" }}>
        {/* Background */}
        <div style={{ position: "fixed", inset: 0, pointerEvents: "none", zIndex: 0 }}>
          <div style={{ position: "absolute", width: 800, height: 800, borderRadius: "50%", background: "radial-gradient(circle, rgba(99,102,241,0.05) 0%, transparent 70%)", top: "20%", left: "30%" }} />
          <div style={{ position: "absolute", width: 500, height: 500, borderRadius: "50%", background: "radial-gradient(circle, rgba(139,92,246,0.04) 0%, transparent 70%)", bottom: "10%", right: "20%" }} />
        </div>

        {/* Sidebar */}
        <div style={{ width: 220, background: "rgba(10, 18, 34, 0.95)", borderRight: "1px solid rgba(99,102,241,0.12)", display: "flex", flexDirection: "column", position: "relative", zIndex: 10, flexShrink: 0 }}>
          {/* Logo */}
          <div style={{ padding: "20px 16px 16px", borderBottom: "1px solid rgba(99,102,241,0.1)" }}>
            <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
              <div style={{ width: 34, height: 34, borderRadius: 10, background: "linear-gradient(135deg, rgba(99,102,241,0.4), rgba(139,92,246,0.3))", border: "1px solid rgba(99,102,241,0.5)", display: "flex", alignItems: "center", justifyContent: "center", boxShadow: "0 0 20px rgba(99,102,241,0.2)", flexShrink: 0 }}>
                <Shield size={17} style={{ color: "#a5b4fc" }} />
              </div>
              <div>
                <div style={{ fontSize: 14, fontWeight: 800, color: "white", lineHeight: 1 }}>
                  <span className="gradient-text">HireGuard</span>
                </div>
                <div style={{ fontSize: 10, color: "#334155", fontFamily: "JetBrains Mono" }}>ENTERPRISE AI</div>
              </div>
            </div>
          </div>

          {/* Nav */}
          <nav style={{ flex: 1, padding: "12px 10px", overflowY: "auto" }}>
            <div style={{ fontSize: 10, color: "#334155", fontFamily: "JetBrains Mono", fontWeight: 600, letterSpacing: "0.1em", padding: "0 6px", marginBottom: 6 }}>PLATFORM</div>
            {navItems.slice(0, 6).map(item => (
              <div key={item.id} className={`sidebar-item ${page === item.id ? "active" : ""}`} onClick={() => setPage(item.id)} style={{ marginBottom: 2 }}>
                <item.icon size={15} />
                <span>{item.label}</span>
                {page === item.id && <ChevronRight size={12} style={{ marginLeft: "auto", opacity: 0.6 }} />}
              </div>
            ))}
            <div style={{ fontSize: 10, color: "#334155", fontFamily: "JetBrains Mono", fontWeight: 600, letterSpacing: "0.1em", padding: "12px 6px 6px", marginTop: 4 }}>SYSTEM</div>
            {navItems.slice(6).map(item => (
              <div key={item.id} className={`sidebar-item ${page === item.id ? "active" : ""}`} onClick={() => setPage(item.id)} style={{ marginBottom: 2 }}>
                <item.icon size={15} />
                <span>{item.label}</span>
              </div>
            ))}
          </nav>

          {/* User footer */}
          <div style={{ padding: "12px 14px", borderTop: "1px solid rgba(99,102,241,0.1)" }}>
            <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
              <div style={{ width: 30, height: 30, borderRadius: 8, background: "linear-gradient(135deg, rgba(99,102,241,0.3), rgba(139,92,246,0.2))", display: "flex", alignItems: "center", justifyContent: "center", color: "#a5b4fc", fontSize: 13, fontWeight: 700, flexShrink: 0 }}>
                {auth.user.name[0]}
              </div>
              <div style={{ flex: 1, minWidth: 0 }}>
                <div style={{ fontSize: 12, color: "#e2e8f0", fontWeight: 600, overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap" }}>{auth.user.name}</div>
                <div style={{ fontSize: 10, color: "#475569" }}>{auth.user.role}</div>
              </div>
              <button onClick={() => setAuth(null)} style={{ background: "none", border: "none", cursor: "pointer", color: "#475569", padding: 4 }} title="Logout">
                <LogOut size={13} />
              </button>
            </div>
          </div>
        </div>

        {/* Main Area */}
        <div style={{ flex: 1, display: "flex", flexDirection: "column", overflow: "hidden", position: "relative", zIndex: 1 }}>
          {/* Header */}
          <div style={{ height: 56, background: "rgba(10,18,34,0.9)", borderBottom: "1px solid rgba(99,102,241,0.1)", display: "flex", alignItems: "center", justifyContent: "space-between", padding: "0 24px", backdropFilter: "blur(12px)", flexShrink: 0 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
              {navItems.find(n => n.id === page) && (
                <>
                  {(() => { const I = navItems.find(n => n.id === page).icon; return <I size={16} style={{ color: "#6366f1" }} />; })()}
                  <span style={{ fontSize: 15, fontWeight: 600, color: "#e2e8f0" }}>{navItems.find(n => n.id === page).label}</span>
                </>
              )}
            </div>
            <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
              <div style={{ position: "relative", flex: 1, maxWidth: 240 }}>
                <Search size={13} style={{ position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)", color: "#475569" }} />
                <input className="input" placeholder="Search..." style={{ width: "100%", borderRadius: 8, padding: "6px 12px 6px 30px", fontSize: 12 }} />
              </div>
              <button onClick={() => setShowNotifPanel(!showNotifPanel)} style={{ width: 34, height: 34, borderRadius: 9, background: "rgba(15,23,42,0.8)", border: "1px solid rgba(99,102,241,0.2)", cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center", position: "relative", color: "#64748b" }}>
                <Bell size={15} />
                {notifications > 0 && <div className="notification-dot" />}
              </button>
              <div style={{ width: 34, height: 34, borderRadius: 9, background: "linear-gradient(135deg, rgba(99,102,241,0.3), rgba(139,92,246,0.2))", display: "flex", alignItems: "center", justifyContent: "center", color: "#a5b4fc", fontWeight: 700, fontSize: 14, border: "1px solid rgba(99,102,241,0.3)", cursor: "pointer" }}>
                {auth.user.name[0]}
              </div>
            </div>
          </div>

          {/* Notification Panel */}
          {showNotifPanel && (
            <div style={{ position: "absolute", top: 60, right: 20, width: 320, zIndex: 50 }} className="scale-in">
              <div className="glass-bright" style={{ borderRadius: 14, padding: 16, boxShadow: "0 20px 60px rgba(0,0,0,0.5)" }}>
                <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 12 }}>
                  <span style={{ fontSize: 12, color: "#64748b", fontFamily: "JetBrains Mono", fontWeight: 600, letterSpacing: "0.06em" }}>NOTIFICATIONS</span>
                  <button onClick={() => setShowNotifPanel(false)} style={{ background: "none", border: "none", cursor: "pointer", color: "#475569" }}><X size={14} /></button>
                </div>
                {[
                  { msg: "High bias detected in Interview #482", time: "2m ago", color: "#ef4444" },
                  { msg: "Resume fraud risk: Candidate J. Doe", time: "15m ago", color: "#f59e0b" },
                  { msg: "Q4 Compliance report ready", time: "1h ago", color: "#10b981" },
                ].map((n, i) => (
                  <div key={i} style={{ display: "flex", gap: 10, padding: "8px 0", borderBottom: "1px solid rgba(99,102,241,0.07)" }}>
                    <div style={{ width: 7, height: 7, borderRadius: "50%", background: n.color, marginTop: 5, flexShrink: 0 }} />
                    <div>
                      <div style={{ fontSize: 12, color: "#e2e8f0" }}>{n.msg}</div>
                      <div style={{ fontSize: 10, color: "#475569", fontFamily: "JetBrains Mono", marginTop: 2 }}>{n.time}</div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Page Content */}
          <div style={{ flex: 1, overflow: "hidden" }} onClick={() => showNotifPanel && setShowNotifPanel(false)}>
            {pageComponents[page]}
          </div>
        </div>
      </div>
    </>
  );
}